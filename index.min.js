const countSubstr=(e,t)=>e.split(t).length-1;function removeQuotedData(e){let t="",r=!1,l=!1,n=!1;e||console.log("a");for(let o=0;o<e.length;++o)'"'!==e[o]||l||r?"'"!==e[o]||l||r?'"'===e[o]&&r&&!n||"'"===e[o]&&l&&!n?(l=!1,r=!1):'"'===e[o]&&r&&n||"'"===e[o]&&l&&n?n=!1:(n="\\"===e[o],l||r||(t+=e[o])):l=!0:r=!0;return t}function seekToFirstUnquotedSemicolon(e,t,r=0){let l="",n=!1,o=!1,s=!1;for(let i=r;i<e.length&&('"'!==e[i]||o||n?"'"!==e[i]||o||n?'"'===e[i]&&n&&!s||"'"===e[i]&&o&&!s?(o=!1,n=!1):s=('"'!==e[i]||!n||!s)&&(("'"!==e[i]||!o||!s)&&"\\"===e[i]):o=!0:n=!0,o||n||(l+=e[i]),e[i]!==t||n||o);++i);return l}function seekToFirstUnquotedSemicolonPreserving(e,t,r=0){let l="",n=!1,o=!1,s=!1;for(let i=r;i<e.length&&('"'!==e[i]||o||n?"'"!==e[i]||o||n?'"'===e[i]&&n&&!s||"'"===e[i]&&o&&!s?(o=!1,n=!1):s=('"'!==e[i]||!n||!s)&&(("'"!==e[i]||!o||!s)&&"\\"===e[i]):o=!0:n=!0,l+=e[i],e[i]!==t||n||o);++i);return l}function seekToFirstUnquotedWord(e,t,r=0){let l="",n=!1,o=!1,s=!1;for(let i=r;i<e.length;++i)if('"'!==e[i]||o||n?"'"!==e[i]||o||n?'"'===e[i]&&n&&!s||"'"===e[i]&&o&&!s?(o=!1,n=!1):s=('"'!==e[i]||!n||!s)&&(("'"!==e[i]||!o||!s)&&"\\"===e[i]):o=!0:n=!0,l+=e[i],e[i]===t[0]&&!n&&!o){let r=!0;for(let l=0;l<t.length;++l)(e.length>i+l&&e[i+l]!==t[l]||e.length<=i+l)&&(r=!1);if(r)break}return l}const trimRules=e=>{for(let t=0;t<e.length;++t)if(void 0!==e[t])if(Array.isArray(e[t]))for(let r=0;r<e[t].length;++r)Array.isArray(e[t][r])?trimRules(e[t][r]):e[t][r]=e[t][r].trim();else e[t]=e[t].trim()},applyScopedCss=e=>{let t="";for(;e.length>0;){let r=seekToFirstUnquotedSemicolonPreserving(e,"}"),l=removeQuotedData(r);for(;countSubstr(l,"{")!==countSubstr(l,"}");){r+=seekToFirstUnquotedSemicolonPreserving(e,"}",r.length),l=removeQuotedData(r)}let n=[];const o=[];let s=0;if(countSubstr(l,"{")>1){const l=r;let i=new Map,a=new Map;for(;removeQuotedData(r).includes("{");){let e=seekToFirstUnquotedSemicolonPreserving(r,"{");r=r.substring(e.length,r.length);let t=removeQuotedData(e),l=t,g=0,u=s;if(!t.includes(";")){let t=e.trim();t.endsWith("{")&&(e=t.substring(0,t.length-1))}for(;t.includes(";");){const l=g;s-=g,g=0;let u="";for(;removeQuotedData(e).includes(";");){const t=seekToFirstUnquotedSemicolonPreserving(e,";");e=e.substring(t.length,e.length),u+=" "+t}let f=removeQuotedData(u);for(;f.includes("}");){let t=seekToFirstUnquotedSemicolonPreserving(u,"}"),r=u.substring(0,t.length-1),l=u.substring(t.length,u.length);u=r,e=l+e,f=removeQuotedData(u),g++}if(0===l)void 0!==o[s]?Array.isArray(o[s])?(a.has(s)||a.set(s,o[s].length),o[s]=[...o[s],u]):(a.has(s)||a.set(s,0),o[s]=[o[s],u]):(a.has(s)||a.set(s,0),o[s]=u);else if(void 0!==o[s])if("string"==typeof n[s])a.has(s)||a.set(s,0),o[s]=o[s]+" "+u;else if(Array.isArray(o[s])){const e=removeQuotedData(r);let t=e.indexOf(";"),l=e.indexOf("{");if(-1===t&&(t=e.length),-1===l&&(l=e.length),Array.isArray(n[s])&&n[s].length>o[s].length&&t<l){let e=o[s];e[a.get(s)]=e[a.get(s)]+" "+u,o[s]=e}else{let e=o[s];e[i.get(s)]=e[i.get(s)]+" "+u,o[s]=e}}else a.has(s)||a.set(s,0),o[s]=o[s]+" "+u;else a.has(s)||a.set(s,0),o[s]=u;if(0===g){let t=e.trim();t.endsWith("{")&&(e=t.substring(0,t.length-1))}t=removeQuotedData(e)}s=u;let f=0,h=0;for(;l.includes("}");)l=l.substring(l.indexOf("}")+1,l.length),s--,h++;for(;l.includes("{");)if(l=l.substring(l.indexOf("{")+1,l.length),s++,0===h){let e=0;if(void 0!==n[s-1])if(Array.isArray(n[s-1])){let t=n[s-1].length;if(Array.isArray(n[s])||(n[s]=[]),void 0!==n[s-1]&&Array.isArray(n[s-1])?i.set(s-1,n[s-1].length-1):offset=0,0===n[s].length)for(;t>n[s].length;)n[s].unshift("");else for(e=n[s].length;t>n[s].length;)n[s].push("")}else void 0===n[s]?n[s]=[""]:Array.isArray(n[s])?n[s].unshift(""):Array.isArray(n[s])||(n[s]=["",n[s]]),void 0!==n[s-1]&&Array.isArray(n[s-1])?i.set(s-1,n[s-1].length-1):offset=0;else void 0===n[s]?n[s]=[""]:Array.isArray(n[s])?n[s].unshift(""):Array.isArray(n[s])||(n[s]=["",n[s]]),void 0!==n[s-1]&&Array.isArray(n[s-1])?i.set(s-1,n[s-1].length-1):offset=0;if(void 0!==o[s-1])if(Array.isArray(o[s-1])){let t=n[s].length;if(Array.isArray(o[s])||(o[s]=[]),0===e)for(;t>o[s].length;)o[s].unshift("");else for(;t>o[s].length;)o[s].push("")}else void 0===o[s]?o[s]=[""]:Array.isArray(o[s])?o[s].unshift(""):Array.isArray(o[s])||(o[s]=["",o[s]]);else void 0===o[s]?o[s]=[""]:Array.isArray(o[s])?o[s].unshift(""):Array.isArray(o[s])||(o[s]=["",o[s]])}else h--;if(void 0!==n[s])if("string"==typeof n[s]){n[s]=[n[s],e];const t=s;for(;s>=0;){for(;void 0!==n[s-1]&&Array.isArray(n[s-1])&&n[s-1].length<n[s].length;)for(n[s-1].push(n[s-1][n[s-1].length-1]);o[s-1].length<n[s-1].length;)o[s-1].push("");s--}s=t}else{n[s]=[...n[s],e];const t=s;for(;s>=0;){for(;void 0!==n[s-1]&&Array.isArray(n[s-1])&&n[s-1].length<n[s].length;)for(n[s-1].push(n[s-1][n[s-1].length-1]);o[s-1].length<n[s-1].length;)o[s-1].push("");s--}s=t}else if(s>1&&void 0!==n[s-1]&&Array.isArray(n[s-1])){n[s]=[];for(let e=0;e<n[s-1].length-1;++e)n[s].push("");n[s].push(e),o[s]=[];for(let e=0;e<n[s-1].length-1;++e)o[s].push("")}else f=0,n[s]=e,insertedNonArray=!0}let g,u=0;for(let e=o.length-1;e>=1;--e){const t=o[e-1];if(void 0===t)continue;const r=o[e];for(;Array.isArray(t)&&Array.isArray(r)&&t.length<r.length;)t.push("");o[e-1]=t}for(;removeQuotedData(r).includes(";");){const e=u;s-=u,u=0;let t="";for(;r.includes(";");){const e=seekToFirstUnquotedSemicolonPreserving(r,";");r=r.substring(e.length,r.length),t+=" "+e}let l=removeQuotedData(t);for(;l.includes("}");){let e=seekToFirstUnquotedSemicolonPreserving(t,"}"),n=t.substring(0,e.length-1);r=t.substring(e.length,t.length)+r,t=n,u++,l=removeQuotedData(t)}if(0===e)void 0!==o[s]?"string"==typeof n[s]?(a.has(s)||a.set(s,0),o[s]=[o[s],t]):Array.isArray(o[s])?(a.has(s)||a.set(s,o[s].length),o[s]=[...o[s],t]):(a.has(s)||a.set(s,0),o[s]=[o[s],t]):(a.has(s)||a.set(s,0),o[s]=t);else if(void 0!==o[s])if("string"==typeof n[s])a.has(s)||a.set(s,0),o[s]=o[s]+" "+t;else if(Array.isArray(o[s])){const e=removeQuotedData(r);let l=e.indexOf(";"),i=e.indexOf("{");if(-1===l&&(l=e.length),-1===i&&(i=e.length),Array.isArray(n[s])&&n[s].length>o[s].length&&l<i){let e=o[s];e[a.get(s)]=e[a.get(s)]+" "+t,o[s]=e}else{let e=o[s];e[a.get(s)]=e[a.get(s)]+" "+t,o[s]=e}}else a.has(s)||a.set(s,0),o[s]=o[s]+" "+t;else a.has(s)||a.set(s,0),o[s]=t}trimRules(o),e=e.substring(l.length,e.length);for(let e=0;e<n.length;++e)if(void 0!==n[e])if(Array.isArray(n[e]))for(let t=0;t<n[e].length;++t){let r=removeQuotedData(n[e][t]);do{if(r.includes("}")){let r=seekToFirstUnquotedSemicolonPreserving(n[e][t],"}"),l=n[e][t].substring(0,r.length-1),o=n[e][t].substring(r.length,n[e][t].length);n[e][t]=l+o}r=removeQuotedData(n[e][t])}while(r.includes("}"))}else{let t=removeQuotedData(n[e]);do{if(t.includes("}")){let t=seekToFirstUnquotedSemicolonPreserving(n[e],"}"),r=n[e].substring(0,t.length-1),l=n[e].substring(t.length,n[e].length);n[e]=r+l}t=removeQuotedData(n[e])}while(t.includes("}"))}for(let e=0;e<n.length;++e)if(void 0!==n[e])if(Array.isArray(n[e]))for(let t=0;t<n[e].length;++t){let r=removeQuotedData(n[e][t]);do{if(r.includes("&")){let r=seekToFirstUnquotedSemicolonPreserving(n[e][t],"&"),l=n[e][t].substring(0,r.length-1),o=n[e][t].substring(r.length,n[e][t].length);n[e][t]=l+o}r=removeQuotedData(n[e][t])}while(r.includes("&"))}else{let t=removeQuotedData(n[e]);do{if(t.includes("&")){let t=seekToFirstUnquotedSemicolonPreserving(n[e],"&"),r=n[e].substring(0,t.length-1),l=n[e].substring(t.length,n[e].length);n[e]=r+l}t=removeQuotedData(n[e])}while(t.includes("&"))}for(let e=0;e<n.length;++e)if(void 0!==n[e])if(Array.isArray(n[e]))for(let t=0;t<n[e].length;++t){let r=removeQuotedData(n[e][t]);do{if(r.includes("@nest")){let r=seekToFirstUnquotedWord(n[e][t],"@nest"),l=n[e][t].substring(0,r.length-5),o=n[e][t].substring(r.length+4,n[e][t].length);n[e][t]=l+o}r=removeQuotedData(n[e][t])}while(r.includes("@nest"))}else{let t=removeQuotedData(n[e]);do{if(t.includes("@nest")){let t=seekToFirstUnquotedWord(n[e],"@nest"),r=n[e].substring(0,t.length-5),l=n[e].substring(t.length+4,n[e].length);n[e]=r+l}t=removeQuotedData(n[e])}while(t.includes("@nest"))}for(let e=0;e<n.length;++e)if(void 0!==n[e])if(Array.isArray(n[e]))for(let t=0;t<n[e].length;++t)n[e][t]=n[e][t].trim();else n[e]=n[e].trim();const f=new Map;for(let e=0;e<n.length;++e)void 0!==n[e]&&f.set(e,[]);void 0!==o[0]&&void 0===n[0]&&(t+=o[0]+" ");for(let e=0;e<n.length;++e)if(void 0!==n[e])if(Array.isArray(n[e]))for(let t=0;t<n[e].length;++t){let r=t;for(let t=0;t<=e;t++)if(void 0!==n[t])if(Array.isArray(n[t])&&n[t].length>r){let l=removeQuotedData(n[t][r]);for(;l.includes(",");){let s=seekToFirstUnquotedSemicolonPreserving(n[t][r],","),i=n[t][r].substring(0,s.length-1),a=n[t][r].substring(s.length,n[t][r].length);n[t][r]=a,n[t].splice(r,0,i),o[t].splice(r,0,o[t][r]);for(let t=0;t<n.length;++t)t!==e&&void 0!==n[t]&&(Array.isArray(n[t])&&n[t].length>r?n[t].splice(r,0,n[t][r]):Array.isArray(n[t])&&n[t].length===r||0===r&&(n[t]=[n[t],n[t]]));for(let t=0;t<o.length;++t)t!==e&&void 0!==o[t]&&(Array.isArray(o[t])&&o[t].length>r?o[t].splice(r,0,o[t][r]):Array.isArray(o[t])&&o[t].length===r||0===r&&(o[t]=[o[t],o[t]]));l=removeQuotedData(n[t][r])}}else if(!Array.isArray(n[t])){let l=removeQuotedData(n[t]);for(;l.includes(",");){let o=seekToFirstUnquotedSemicolonPreserving(n[t],","),s=n[t].substring(0,o.length-1),i=n[t].substring(o.length,n[t].length);n[t]=i,n[t]=[n[t],s],l=removeQuotedData(n[t][r]);for(let t=e+1;t<n.length;++t)Array.isArray(n[t])&&n[t].length>r?n[t].splice(r,0,n[t][r]):0===r&&(n[t]=[n[t],n[t]])}}}else{o[e];let t=0;for(let r=0;r<=e;r++)if(void 0!==n[r])if(Array.isArray(n[r])){let l=removeQuotedData(n[r][t]);for(;l.includes(",");){let o=seekToFirstUnquotedSemicolonPreserving(n[r][t],","),s=n[r][t].substring(0,o.length-1),i=n[r][t].substring(o.length,n[r][t].length);n[r][t]=i,n[r].splice(t,0,s),l=removeQuotedData(n[r][t]);for(let r=e+1;r<n.length;++r)Array.isArray(n[r])&&n[r].length>t?n[r].splice(t,0,n[r][t]):0===t&&(n[r]=[n[r],n[r]])}}else{let l=removeQuotedData(n[r]);for(;l.includes(",");){let o=seekToFirstUnquotedSemicolonPreserving(n[r],","),s=n[r].substring(0,o.length-1),i=n[r].substring(o.length,n[r].length);n[r]=i,n[r]=[n[r],s],l=removeQuotedData(n[r][t]);for(let r=e+1;r<n.length;++r)Array.isArray(n[r])&&n[r].length>t?n[r].splice(t,0,n[r][t]):0===t&&(n[r]=[n[r],n[r]])}}}for(let e=0;e<n.length;++e)if(4===e&&console.log("a"),void 0!==n[e])if(Array.isArray(n[e]))for(let r=n[e].length-1;r>=0;--r){const l=o[e][r];let s="",i=r,a=-1;for(let t=0;t<=e;t++)if(void 0!==n[t])if(Array.isArray(n[t])&&n[t].length>i){let r=removeQuotedData(n[t][i]);const l=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(n[t][i],","),o=n[t][i].substring(0,l.length-1),s=n[t][i].substring(l.length,n[t][i].length);n[t][i]=s,n[t].splice(i,0,o);for(let t=e+1;t<n.length;++t)Array.isArray(n[t])&&n[t].length>i?n[t].splice(i,0,n[t][i]):0===i&&(n[t]=[n[t],n[t]]);r=removeQuotedData(n[t][i])}if(n[t][i].trim().startsWith(":")){if(""!==n[t][i]){s=s.trim()+n[t][i].trim()+" ",g=n[t][i].trim();for(let r=0;r<l;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+n[t][i].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+n[t][i].trim()+" ",e-1>a&&(a=e-1))}))}}else if(""!==n[t][i]){s+=n[t][i]+" ",g=n[t][i];for(let r=0;r<l;++r)f.get(e)[r].value+=n[t][i]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=n[t][i].trim()+" ",e-1>a&&(a=e-1))}))}}else if(!Array.isArray(n[t])){let r=removeQuotedData(n[t]);const l=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(n[t],","),o=n[t].substring(0,l.length-1),s=n[t].substring(l.length,n[t].length);n[t]=s,n[t]=[n[t],o],r=removeQuotedData(n[t][i]);for(let t=e+1;t<n.length;++t)Array.isArray(n[t])&&n[t].length>i?n[t].splice(i,0,n[t][i]):0===i&&(n[t]=[n[t],n[t]])}if(n[t].trim().startsWith(":")){if(""!==n[t]){s=s.trim()+n[t].trim()+" ",g=n[t].trim();for(let r=0;r<l;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+n[t].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+n[t].trim()+" ",e-1>a&&(a=e-1))}))}}else if(""!==n[t]){s+=n[t]+" ",g=n[t];for(let r=0;r<l;++r)f.get(e)[r].value+=n[t]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value+=n[t]+" ",e-1>a&&(a=e-1))}))}}if(s&&l){const e=formatMediaQuery(s);if(null===e)t+=s+"{"+l+"}\n";else{""!==e[1].trim()?t+=e[0]+"{"+e[1]+"{"+l+"} }\n":t+=e[0]+"{"+l+"}";for(let r=0;r<e[2];++r)t+="} "}}for(let r=0;r<f.get(e).length;++r){const n=formatMediaQuery(f.get(e)[r].value);if(null===n)t+=f.get(e)[r].value+"{"+l+"}\n";else{""!==n[1].trim()?t+=n[0]+"{"+n[1]+"{"+l+"} }\n":t+=n[0]+"{"+l+"}";for(let e=0;e<n[2];++e)t+="} "}}for(;a>=0;--a)if(void 0!==f.get(a))for(let e=0;e<f.get(a).length;++e){const r=formatMediaQuery(f.get(a)[e].value);if(null===r)t+=f.get(a)[e].value+"{"+l+"}\n";else{""!==r[1].trim()?t+=r[0]+"{"+r[1]+"{"+l+"} }\n":t+=r[0]+"{"+l+"}";for(let e=0;e<r[2];++e)t+="} "}f.get(a)[e].value=f.get(a)[e].origValue}}else{const r=o[e];let l="",s=0,i=-1;for(let t=0;t<=e;t++)if(void 0!==n[t])if(Array.isArray(n[t])){let r=removeQuotedData(n[t][s]);const o=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(n[t][s],","),o=n[t][s].substring(0,l.length-1),i=n[t][s].substring(l.length,n[t][s].length);n[t][s]=i,n[t].splice(s,0,o),r=removeQuotedData(n[t][s]);for(let t=e+1;t<n.length;++t)Array.isArray(n[t])&&n[t].length>s?n[t].splice(s,0,n[t][s]):0===s&&(n[t]=[n[t],n[t]])}if(n[t][s].trim().startsWith(":")){if(""!==n[t][s]){l=l.trim()+n[t][s].trim()+" ",g=n[t][s].trim();for(let r=0;r<o;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+n[t][s].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+n[t][s].trim()+" ",e-1>i&&(i=e-1))}))}}else if(""!==n[t][s]){l+=n[t][s]+" ",g=n[t][s];for(let r=0;r<o;++r)f.get(e)[r].value+=n[t][s]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=n[t][s].trim()+" ",e-1>i&&(i=e-1))}))}}else{let r=removeQuotedData(n[t]);const o=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(n[t],","),o=n[t].substring(0,l.length-1),i=n[t].substring(l.length,n[t].length);n[t]=i,n[t]=[n[t],o],r=removeQuotedData(n[t][s]);for(let t=e+1;t<n.length;++t)Array.isArray(n[t])&&n[t].length>s?n[t].splice(s,0,n[t][s]):0===s&&(n[t]=[n[t],n[t]])}if(n[t].trim().startsWith(":")){if(""!==n[t]){l=l.trim()+n[t].trim()+" ",g=n[t].trim();for(let r=0;r<o;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+n[t].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+n[t].trim()+" ",e-1>i&&(i=e-1))}))}}else if(""!==n[t]){l+=n[t]+" ",g=n[t];for(let r=0;r<o;++r)f.get(e)[r].value+=n[t]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=n[t]+" ",e-1>i&&(i=e-1))}))}}if(l&&r){const e=formatMediaQuery(l);if(null===e)t+=l+"{"+r+"}\n";else{""!==e[1].trim()?t+=e[0]+"{"+e[1]+"{"+r+"} }\n":t+=e[0]+"{"+r+"}";for(let r=0;r<e[2];++r)t+="} "}}for(let l=0;l<f.get(e).length;++l){const n=formatMediaQuery(f.get(e)[l].value);if(null===n){t+=f.get(e)[l].value+"{"+r+"}\n";for(let t=e-1;t>=0;--t)if(void 0!==f.get(t)){const e=[];for(let r=0;r<f.get(t).length;++r){const l={};l.origValue=f.get(t)[r].origValue+" "+g,l.value=f.get(t)[r].value+" "+g,l.idx=f.get(t)[r].idx,e.push(l)}const r=f.get(t).concat(e);f.set(t,r)}}else{""!==n[1].trim()?t+=n[0]+"{"+n[1]+"{"+r+"} }\n":t+=n[0]+"{"+r+"}";for(let e=0;e<n[2];++e)t+="} "}}for(;i>=0;--i)if(void 0!==f.get(i))for(let e=0;e<f.get(i).length;++e){const l=formatMediaQuery(f.get(i)[e].value);if(null===l)t+=f.get(i)[e].value+"{"+r+"}\n";else{""!==l[1].trim()?t+=l[0]+"{"+l[1]+"{"+r+"} }\n":t+=l[0]+"{"+r+"}";for(let e=0;e<l[2];++e)t+="} "}f.get(i)[e].value=f.get(i)[e].origValue}}console.log("a")}else e=e.substring(r.length,e.length),t+=r.trim()+"\n"}return console.log(t),t},atSet=new Set(["@media","@layer"]),formatMediaQuery=e=>{let t=removeQuotedData(e);e.includes("fake")&&console.log("a");let r="",l=0;for(const n of atSet)for(;t.includes(n);){let o=seekToFirstUnquotedWord(e,n),s=e.substring(0,o.length-1),i=e.substring(o.length-1,e.length),a=i.substring(0,i.indexOf(n)+n.length);i=i.substring(a.length,i.length).trim();let g="",u=seekToFirstUnquotedSemicolon(i," ");for(u.length>g&&(g=u),u=seekToFirstUnquotedSemicolon(i,"{"),u.length>g&&(g=u),!i.includes(" ")&&g.length<i&&(g=i);g.includes("(")&&countSubstr(g,"(")!==countSubstr(g,")");)g=i.substring(0,i.indexOf(")",g.length)+1);i=i.substring(g.length,i.length),a+=" "+g,""===r?r+=a:"@media"===n?r+=" and "+a:"@layer"===n&&(r+=" { "+a,l++),0===l?e=s+" "+i:(""!==s.trim()&&(i=s+" "+i),e=" "+i),t=removeQuotedData(e)}return""!==r?[r,e,l]:null},stylesheets=document.querySelectorAll("style");for(const e of stylesheets){let t=e.textContent,r=applyScopedCss(t);e.textContent=r}const externalSheets=document.querySelectorAll("link");for(const e of externalSheets)"stylesheet"===e.rel&&fetch(e.href).then((e=>e.text())).then((t=>{var r=document.createElement("style");r.textContent=applyScopedCss(t),document.head.appendChild(r),document.head.removeChild(e)}));