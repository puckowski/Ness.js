const countSubstr=(e,t)=>e.split(t).length-1;function removeQuotedData(e){let t="",r=!1,l=!1,o=!1;e||console.log("a");for(let i=0;i<e.length;++i)'"'!==e[i]||l||r?"'"!==e[i]||l||r?'"'===e[i]&&r&&!o||"'"===e[i]&&l&&!o?(l=!1,r=!1):'"'===e[i]&&r&&o||"'"===e[i]&&l&&o?o=!1:(o="\\"===e[i],l||r||(t+=e[i])):l=!0:r=!0;return t}function seekToFirstUnquotedSemicolon(e,t,r=0){let l="",o=!1,i=!1,n=!1;for(let s=r;s<e.length&&('"'!==e[s]||i||o?"'"!==e[s]||i||o?'"'===e[s]&&o&&!n||"'"===e[s]&&i&&!n?(i=!1,o=!1):n=('"'!==e[s]||!o||!n)&&(("'"!==e[s]||!i||!n)&&"\\"===e[s]):i=!0:o=!0,i||o||(l+=e[s]),e[s]!==t||o||i);++s);return l}function seekToFirstUnquotedSemicolonPreserving(e,t,r=0){let l="",o=!1,i=!1,n=!1;for(let s=r;s<e.length&&('"'!==e[s]||i||o?"'"!==e[s]||i||o?'"'===e[s]&&o&&!n||"'"===e[s]&&i&&!n?(i=!1,o=!1):n=('"'!==e[s]||!o||!n)&&(("'"!==e[s]||!i||!n)&&"\\"===e[s]):i=!0:o=!0,l+=e[s],e[s]!==t||o||i);++s);return l}function seekToFirstUnquotedWord(e,t,r=0){let l="",o=!1,i=!1,n=!1;for(let s=r;s<e.length;++s)if('"'!==e[s]||i||o?"'"!==e[s]||i||o?'"'===e[s]&&o&&!n||"'"===e[s]&&i&&!n?(i=!1,o=!1):n=('"'!==e[s]||!o||!n)&&(("'"!==e[s]||!i||!n)&&"\\"===e[s]):i=!0:o=!0,l+=e[s],e[s]===t[0]&&!o&&!i){let r=!0;for(let l=0;l<t.length;++l)(e.length>s+l&&e[s+l]!==t[l]||e.length<=s+l)&&(r=!1);if(r)break}return l}const trimRules=e=>{for(let t=0;t<e.length;++t)if(void 0!==e[t])if(Array.isArray(e[t]))for(let r=0;r<e[t].length;++r)Array.isArray(e[t][r])?trimRules(e[t][r]):e[t][r]=e[t][r].trim();else e[t]=e[t].trim()},applyScopedCss=(e,t)=>{let r="";for(;t.length>0;){let e=seekToFirstUnquotedSemicolonPreserving(t,"}"),l=removeQuotedData(e);for(;countSubstr(l,"{")!==countSubstr(l,"}");){e+=seekToFirstUnquotedSemicolonPreserving(t,"}",e.length),l=removeQuotedData(e)}let o=[];const i=[];let n=0;if(countSubstr(l,"{")>1){const l=e;let s=!1;for(;removeQuotedData(e).includes("{");){let t=seekToFirstUnquotedSemicolonPreserving(e,"{");e=e.substring(t.length,e.length);let r=removeQuotedData(t),l=countSubstr(r,"}"),u=r,g=0,a=n;if(!r.includes(";")){let e=t.trim();e.endsWith("{")&&(t=e.substring(0,e.length-1))}for(;r.includes(";");){const e=g;n-=g,g=0;let u="";for(;removeQuotedData(t).includes(";");){const e=seekToFirstUnquotedSemicolonPreserving(t,";");t=t.substring(e.length,t.length),u+=" "+e}let a=removeQuotedData(u);for(;a.includes("}");){let e=seekToFirstUnquotedSemicolonPreserving(u,"}"),r=u.substring(0,e.length-1),l=u.substring(e.length,u.length);u=r,t=l+t,a=removeQuotedData(u),g++}if(0===e)void 0!==i[n]?Array.isArray(i[n])?i[n]=[...i[n],u]:i[n]=[i[n],u]:i[n]=u;else if(void 0!==i[n])if("string"==typeof o[n])i[n]=i[n]+" "+u;else if(Array.isArray(i[n])){let e=i[n];e[e.length-1]=e[e.length-1]+" "+u,i[n]=e}else i[n]=i[n]+" "+u;else i[n]=u;if(0===g){let e=t.trim();e.endsWith("{")&&(t=e.substring(0,e.length-1))}if(r=removeQuotedData(t),s&&l>0&&void 0!==o[n-1]){const e=Array.isArray(o[n-1]),t=!Array.isArray(o[n]),r=o[n-1].length>1;if(e&&t&&r){s=!1,o[n]=[o[n]];let e=l;for(;l>1;)o[n].unshift(""),l--;if(!Array.isArray(i[n]))for(i[n]=[i[n]];e>1;)i[n].unshift(""),e--}}}for(n=a;u.includes("}");)u=u.substring(u.indexOf("}")+1,u.length),n--;for(;u.includes("{");)u=u.substring(u.indexOf("{")+1,u.length),n++;if(void 0!==o[n])if("string"==typeof o[n])for(o[n]=[o[n],t];void 0!==o[n-1]&&o[n-1].length<o[n].length;)o[n-1].push(o[n-1][o[n-1].length-1]),i[n].push("");else for(o[n]=[...o[n],t];void 0!==o[n-1]&&o[n-1].length<o[n].length;)o[n-1].push(o[n-1][o[n-1].length-1]),i[n].push("");else o[n]=t,s=!0}let u,g=0;for(;removeQuotedData(e).includes(";");){const t=g;n-=g,g=0;let r="";for(;e.includes(";");){const t=seekToFirstUnquotedSemicolonPreserving(e,";");e=e.substring(t.length,e.length),r+=" "+t}let l=removeQuotedData(r);for(;l.includes("}");){let t=seekToFirstUnquotedSemicolonPreserving(r,"}"),o=r.substring(0,t.length-1);e=r.substring(t.length,r.length)+e,r=o,g++,l=removeQuotedData(r)}if(0===t)void 0!==i[n]?"string"==typeof o[n]?i[n]=[i[n],r]:Array.isArray(i[n])?i[n]=[...i[n],r]:i[n]=[i[n],r]:i[n]=r;else if(void 0!==i[n])if("string"==typeof o[n])i[n]=i[n]+" "+r;else if(Array.isArray(i[n])){let e=i[n];e[e.length-1]=e[e.length-1]+" "+r,i[n]=e}else i[n]=i[n]+" "+r;else i[n]=r}trimRules(i),t=t.substring(l.length,t.length);for(let e=0;e<o.length;++e)if(void 0!==o[e])if(Array.isArray(o[e]))for(let t=0;t<o[e].length;++t){let r=removeQuotedData(o[e][t]);do{if(r.includes("}")){let r=seekToFirstUnquotedSemicolonPreserving(o[e][t],"}"),l=o[e][t].substring(0,r.length-1),i=o[e][t].substring(r.length,o[e][t].length);o[e][t]=l+i}r=removeQuotedData(o[e][t])}while(r.includes("}"))}else{let t=removeQuotedData(o[e]);do{if(t.includes("}")){let t=seekToFirstUnquotedSemicolonPreserving(o[e],"}"),r=o[e].substring(0,t.length-1),l=o[e].substring(t.length,o[e].length);o[e]=r+l}t=removeQuotedData(o[e])}while(t.includes("}"))}for(let e=0;e<o.length;++e)if(void 0!==o[e])if(Array.isArray(o[e]))for(let t=0;t<o[e].length;++t){let r=removeQuotedData(o[e][t]);do{if(r.includes("&")){let r=seekToFirstUnquotedSemicolonPreserving(o[e][t],"&"),l=o[e][t].substring(0,r.length-1),i=o[e][t].substring(r.length,o[e][t].length);o[e][t]=l+i}r=removeQuotedData(o[e][t])}while(r.includes("&"))}else{let t=removeQuotedData(o[e]);do{if(t.includes("&")){let t=seekToFirstUnquotedSemicolonPreserving(o[e],"&"),r=o[e].substring(0,t.length-1),l=o[e].substring(t.length,o[e].length);o[e]=r+l}t=removeQuotedData(o[e])}while(t.includes("&"))}for(let e=0;e<o.length;++e)if(void 0!==o[e])if(Array.isArray(o[e]))for(let t=0;t<o[e].length;++t){let r=removeQuotedData(o[e][t]);do{if(r.includes("@nest")){let r=seekToFirstUnquotedWord(o[e][t],"@nest"),l=o[e][t].substring(0,r.length-5),i=o[e][t].substring(r.length+4,o[e][t].length);o[e][t]=l+i}r=removeQuotedData(o[e][t])}while(r.includes("@nest"))}else{let t=removeQuotedData(o[e]);do{if(t.includes("@nest")){let t=seekToFirstUnquotedWord(o[e],"@nest"),r=o[e].substring(0,t.length-5),l=o[e].substring(t.length+4,o[e].length);o[e]=r+l}t=removeQuotedData(o[e])}while(t.includes("@nest"))}for(let e=0;e<o.length;++e)if(void 0!==o[e])if(Array.isArray(o[e]))for(let t=0;t<o[e].length;++t)o[e][t]=o[e][t].trim();else o[e]=o[e].trim();const a=new Map;for(let e=0;e<o.length;++e)void 0!==o[e]&&a.set(e,[]);void 0!==i[0]&&void 0===o[0]&&(r+=i[0]+" ");for(let e=0;e<o.length;++e)if(4===e&&console.log("a"),void 0!==o[e])if(Array.isArray(o[e]))for(let t=o[e].length-1;t>=0;--t){const l=i[e][t];let n="",s=t,g=-1;for(let t=0;t<=e;t++)if(void 0!==o[t])if(Array.isArray(o[t])&&o[t].length>s){let r=removeQuotedData(o[t][s]);const l=a.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(o[t][s],","),i=o[t][s].substring(0,l.length-1),u=o[t][s].substring(l.length,o[t][s].length);o[t][s]=u,a.get(e).push({idx:e,value:n+i+" ",origValue:n+i+" "}),r=removeQuotedData(o[t][s]);for(let t=0;t<e;++t)if(void 0!==a.get(t)){const r=a.get(t);for(let t=0;t<r.length;++t)a.get(e).push({idx:e,value:r[t].origValue+i+" ",origValue:r[t].origValue+i+" "})}}if(o[t][s].trim().startsWith(":")){if(""!==o[t][s]){n=n.trim()+o[t][s].trim()+" ",u=o[t][s].trim();for(let r=0;r<l;++r)a.get(e)[r].value=a.get(e)[r].value.trim()+o[t][s].trim()+" ";for(const[r,l]of a)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+o[t][s].trim()+" ",e-1>g&&(g=e-1))}))}}else if(""!==o[t][s]){n+=o[t][s]+" ",u=o[t][s];for(let r=0;r<l;++r)a.get(e)[r].value+=o[t][s]+" ";for(const[r,l]of a)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=o[t][s].trim()+" ",e-1>g&&(g=e-1))}))}}else if(!Array.isArray(o[t])){let r=removeQuotedData(o[t]);const l=a.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(o[t],","),i=o[t].substring(0,l.length-1),s=o[t].substring(l.length,o[t].length);o[t]=s,a.get(e).push({idx:e,value:n+i+" ",origValue:n+i+" "}),r=removeQuotedData(o[t]);for(let t=0;t<e;++t)if(void 0!==a.get(t)){const r=a.get(t);for(let t=0;t<r.length;++t)a.get(e).push({idx:e,value:r[t].origValue+i+" ",origValue:r[t].origValue+i+" "})}}if(o[t].trim().startsWith(":")){if(""!==o[t]){n=n.trim()+o[t].trim()+" ",u=o[t].trim();for(let r=0;r<l;++r)a.get(e)[r].value=a.get(e)[r].value.trim()+o[t].trim()+" ";for(const[r,l]of a)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+o[t].trim()+" ",e-1>g&&(g=e-1))}))}}else if(""!==o[t]){n+=o[t]+" ",u=o[t];for(let r=0;r<l;++r)a.get(e)[r].value+=o[t]+" ";for(const[r,l]of a)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value+=o[t]+" ",e-1>g&&(g=e-1))}))}}if(n&&l){const e=formatMediaQuery(n);if(null===e)r+=n+"{"+l+"}\n";else{""!==e[1].trim()?r+=e[0]+"{"+e[1]+"{"+l+"} }\n":r+=e[0]+"{"+l+"}";for(let t=0;t<e[2];++t)r+="} "}}for(let t=0;t<a.get(e).length;++t){const o=formatMediaQuery(a.get(e)[t].value);if(null===o)r+=a.get(e)[t].value+"{"+l+"}\n";else{""!==o[1].trim()?r+=o[0]+"{"+o[1]+"{"+l+"} }\n":r+=o[0]+"{"+l+"}";for(let e=0;e<o[2];++e)r+="} "}}for(;g>=0;--g)if(void 0!==a.get(g))for(let e=0;e<a.get(g).length;++e){const t=formatMediaQuery(a.get(g)[e].value);if(null===t)r+=a.get(g)[e].value+"{"+l+"}\n";else{""!==t[1].trim()?r+=t[0]+"{"+t[1]+"{"+l+"} }\n":r+=t[0]+"{"+l+"}";for(let e=0;e<t[2];++e)r+="} "}a.get(g)[e].value=a.get(g)[e].origValue}}else{const t=i[e];let l="",n=0,s=-1;for(let t=0;t<=e;t++)if(void 0!==o[t])if(Array.isArray(o[t])){let r=removeQuotedData(o[t][n]);const i=a.get(e).length;for(;r.includes(",");){let i=seekToFirstUnquotedSemicolonPreserving(o[t][n],","),s=o[t][n].substring(0,i.length-1),u=o[t][n].substring(i.length,o[t][n].length);o[t][n]=u,a.get(e).push({idx:e,value:l+s+" ",origValue:l+s+" "}),r=removeQuotedData(o[t][n]);for(let t=0;t<e;++t)if(void 0!==a.get(t)){const r=a.get(t);for(let t=0;t<r.length;++t)a.get(e).push({idx:e,value:r[t].origValue+s+" ",origValue:r[t].origValue+s+" "})}}if(o[t][n].trim().startsWith(":")){if(""!==o[t][n]){l=l.trim()+o[t][n].trim()+" ",u=o[t][n].trim();for(let r=0;r<i;++r)a.get(e)[r].value=a.get(e)[r].value.trim()+o[t][n].trim()+" ";for(const[r,l]of a)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+o[t][n].trim()+" ",e-1>s&&(s=e-1))}))}}else if(""!==o[t][n]){l+=o[t][n]+" ",u=o[t][n];for(let r=0;r<i;++r)a.get(e)[r].value+=o[t][n]+" ";for(const[r,l]of a)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=o[t][n].trim()+" ",e-1>s&&(s=e-1))}))}}else{let r=removeQuotedData(o[t]);const i=a.get(e).length;for(;r.includes(",");){let i=seekToFirstUnquotedSemicolonPreserving(o[t],","),n=o[t].substring(0,i.length-1),s=o[t].substring(i.length,o[t].length);o[t]=s,a.get(e).push({idx:e,value:l+n+" ",origValue:l+n+" "}),r=removeQuotedData(o[t]);for(let t=0;t<e;++t)if(void 0!==a.get(t)){const r=a.get(t);for(let t=0;t<r.length;++t)a.get(e).push({idx:e,value:r[t].origValue+n+" ",origValue:r[t].origValue+n+" "})}}if(o[t].trim().startsWith(":")){if(""!==o[t]){l=l.trim()+o[t].trim()+" ",u=o[t].trim();for(let r=0;r<i;++r)a.get(e)[r].value=a.get(e)[r].value.trim()+o[t].trim()+" ";for(const[r,l]of a)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+o[t].trim()+" ",e-1>s&&(s=e-1))}))}}else if(""!==o[t]){l+=o[t]+" ",u=o[t];for(let r=0;r<i;++r)a.get(e)[r].value+=o[t]+" ";for(const[r,l]of a)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=o[t]+" ",e-1>s&&(s=e-1))}))}}if(l&&t){const e=formatMediaQuery(l);if(null===e)r+=l+"{"+t+"}\n";else{""!==e[1].trim()?r+=e[0]+"{"+e[1]+"{"+t+"} }\n":r+=e[0]+"{"+t+"}";for(let t=0;t<e[2];++t)r+="} "}}for(let l=0;l<a.get(e).length;++l){const o=formatMediaQuery(a.get(e)[l].value);if(null===o){r+=a.get(e)[l].value+"{"+t+"}\n";for(let t=e-1;t>=0;--t)if(void 0!==a.get(t)){const e=[];for(let r=0;r<a.get(t).length;++r){const l={};l.origValue=a.get(t)[r].origValue+" "+u,l.value=a.get(t)[r].value+" "+u,l.idx=a.get(t)[r].idx,e.push(l)}const r=a.get(t).concat(e);a.set(t,r)}}else{""!==o[1].trim()?r+=o[0]+"{"+o[1]+"{"+t+"} }\n":r+=o[0]+"{"+t+"}";for(let e=0;e<o[2];++e)r+="} "}}for(;s>=0;--s)if(void 0!==a.get(s))for(let e=0;e<a.get(s).length;++e){const l=formatMediaQuery(a.get(s)[e].value);if(null===l)r+=a.get(s)[e].value+"{"+t+"}\n";else{""!==l[1].trim()?r+=l[0]+"{"+l[1]+"{"+t+"} }\n":r+=l[0]+"{"+t+"}";for(let e=0;e<l[2];++e)r+="} "}a.get(s)[e].value=a.get(s)[e].origValue}}console.log("a")}else t=t.substring(e.length,t.length),r+=e.trim()+"\n"}return console.log(r),r},atSet=new Set(["@media","@layer"]),formatMediaQuery=e=>{let t=removeQuotedData(e);e.includes("fake")&&console.log("a");let r="",l=0;for(const o of atSet)for(;t.includes(o);){let i=seekToFirstUnquotedWord(e,o),n=e.substring(0,i.length-1),s=e.substring(i.length-1,e.length),u=s.substring(0,s.indexOf(o)+o.length);s=s.substring(u.length,s.length).trim();let g="",a=seekToFirstUnquotedSemicolon(s," ");for(a.length>g&&(g=a),a=seekToFirstUnquotedSemicolon(s,"{"),a.length>g&&(g=a),!s.includes(" ")&&g.length<s&&(g=s);g.includes("(")&&countSubstr(g,"(")!==countSubstr(g,")");)g=s.substring(0,s.indexOf(")",g.length)+1);s=s.substring(g.length,s.length),u+=" "+g,""===r?r+=u:"@media"===o?r+=" and "+u:"@layer"===o&&(r+=" { "+u,l++),0===l?e=n+" "+s:(""!==n.trim()&&(s=n+" "+s),e=" "+s),t=removeQuotedData(e)}return""!==r?[r,e,l]:null},stylesheets=document.querySelectorAll("style");for(const e of stylesheets){let t=e.textContent,r=applyScopedCss(0,t);e.textContent=r}const externalSheets=document.querySelectorAll("link");for(const e of externalSheets)"stylesheet"===e.rel&&fetch(e.href).then((e=>e.text())).then((t=>{var r=document.createElement("style");r.textContent=applyScopedCss(0,t),document.head.appendChild(r),document.head.removeChild(e)}));