const countSubstr=(e,t)=>e.split(t).length-1;function removeQuotedData(e){let t="",r=!1,o=!1,l=!1;for(let n=0;n<e.length;++n)'"'!==e[n]||o||r?"'"!==e[n]||o||r?'"'===e[n]&&r&&!l||"'"===e[n]&&o&&!l?(o=!1,r=!1):'"'===e[n]&&r&&l||"'"===e[n]&&o&&l?l=!1:(l="\\"===e[n],o||r||(t+=e[n])):o=!0:r=!0;return t}function seekToFirstUnquotedSemicolon(e,t,r=0){let o="",l=!1,n=!1,i=!1;for(let s=r;s<e.length&&('"'!==e[s]||n||l?"'"!==e[s]||n||l?'"'===e[s]&&l&&!i||"'"===e[s]&&n&&!i?(n=!1,l=!1):i=('"'!==e[s]||!l||!i)&&(("'"!==e[s]||!n||!i)&&"\\"===e[s]):n=!0:l=!0,n||l||(o+=e[s]),e[s]!==t||l||n);++s);return o}function seekToFirstUnquotedSemicolonPreserving(e,t,r=0){let o="",l=!1,n=!1,i=!1;for(let s=r;s<e.length&&('"'!==e[s]||n||l?"'"!==e[s]||n||l?'"'===e[s]&&l&&!i||"'"===e[s]&&n&&!i?(n=!1,l=!1):i=('"'!==e[s]||!l||!i)&&(("'"!==e[s]||!n||!i)&&"\\"===e[s]):n=!0:l=!0,o+=e[s],e[s]!==t||l||n);++s);return o}function seekToFirstUnquotedWord(e,t,r=0){let o="",l=!1,n=!1,i=!1;for(let s=r;s<e.length;++s)if('"'!==e[s]||n||l?"'"!==e[s]||n||l?'"'===e[s]&&l&&!i||"'"===e[s]&&n&&!i?(n=!1,l=!1):i=('"'!==e[s]||!l||!i)&&(("'"!==e[s]||!n||!i)&&"\\"===e[s]):n=!0:l=!0,o+=e[s],e[s]===t[0]&&!l&&!n){let r=!0;for(let o=0;o<t.length;++o)(e.length>s+o&&e[s+o]!==t[o]||e.length<=s+o)&&(r=!1);if(r)break}return o}const trimRules=e=>{for(let t=0;t<e.length;++t)if(void 0!==e[t])if(Array.isArray(e[t]))for(let r=0;r<e[t].length;++r)Array.isArray(e[t][r])?trimRules(e[t][r]):e[t][r]=e[t][r].trim();else e[t]=e[t].trim()},applyScopedCss=(e,t)=>{let r="";for(;t.length>0;){let e=seekToFirstUnquotedSemicolonPreserving(t,"}"),o=removeQuotedData(e);for(;countSubstr(o,"{")!==countSubstr(o,"}");){e+=seekToFirstUnquotedSemicolonPreserving(t,"}",e.length),o=removeQuotedData(e)}const l=[],n=[];let i=0;if(countSubstr(o,"{")>1){const o=e;for(;removeQuotedData(e).includes("{");){let t=seekToFirstUnquotedSemicolonPreserving(e,"{");e=e.substring(t.length,e.length);let r=removeQuotedData(t),o=r,s=0,u=i;for(r.includes(";")||(t=t.substring(0,t.length-2));r.includes(";");){const e=s;i-=s,s=0;let o="";for(;removeQuotedData(t).includes(";");){const e=seekToFirstUnquotedSemicolonPreserving(t,";");t=t.substring(e.length,t.length),o+=" "+e}let u=removeQuotedData(o);for(;u.includes("}");){let e=seekToFirstUnquotedSemicolonPreserving(o,"}"),r=o.substring(0,e.length-1),l=o.substring(e.length,o.length);o=r,t=l+t,u=removeQuotedData(o),s++}if(0===e)void 0!==n[i]?Array.isArray(n[i])?n[i]=[...n[i],o]:n[i]=[n[i],o]:n[i]=o;else if(void 0!==n[i])if("string"==typeof l[i])n[i]=n[i]+" "+o;else if(Array.isArray(n[i])){let e=n[i];e[e.length-1]=e[e.length-1]+" "+o,n[i]=e}else n[i]=n[i]+" "+o;else n[i]=o;0===s&&(t=t.substring(0,t.length-2)),r=removeQuotedData(t)}for(i=u;o.includes("}");)o=o.substring(o.indexOf("}")+1,o.length),i--;for(;o.includes("{");)o=o.substring(o.indexOf("{")+1,o.length),i++;void 0!==l[i]?"string"==typeof l[i]?l[i]=[l[i],t]:l[i]=[...l[i],t]:l[i]=t}let s=0;for(;removeQuotedData(e).includes(";");){const t=s;i-=s,s=0;let r="";for(;e.includes(";");){const t=seekToFirstUnquotedSemicolonPreserving(e,";");e=e.substring(t.length,e.length),r+=" "+t}let o=removeQuotedData(r);for(;o.includes("}");){let t=seekToFirstUnquotedSemicolonPreserving(r,"}"),l=r.substring(0,t.length-1);e=r.substring(t.length,r.length)+e,r=l,s++,o=removeQuotedData(r)}if(0===t)void 0!==n[i]?"string"==typeof l[i]?n[i]=[n[i],r]:Array.isArray(n[i])?n[i]=[...n[i],r]:n[i]=[n[i],r]:n[i]=r;else if(void 0!==n[i])if("string"==typeof l[i])n[i]=n[i]+" "+r;else if(Array.isArray(n[i])){let e=n[i];e[e.length-1]=e[e.length-1]+" "+r,n[i]=e}else n[i]=n[i]+" "+r;else n[i]=r}trimRules(n),console.log(o),t=t.substring(o.length,t.length);for(let e=0;e<l.length;++e)if(void 0!==l[e])if(Array.isArray(l[e]))for(let t=0;t<l[e].length;++t){let r=removeQuotedData(l[e][t]);do{if(r.includes("}")){let r=seekToFirstUnquotedSemicolonPreserving(l[e][t],"}"),o=l[e][t].substring(0,r.length-1),n=l[e][t].substring(r.length,l[e][t].length);l[e][t]=o+n}r=removeQuotedData(l[e][t])}while(r.includes("}"))}else{let t=removeQuotedData(l[e]);do{if(t.includes("}")){let t=seekToFirstUnquotedSemicolonPreserving(l[e],"}"),r=l[e].substring(0,t.length-1),o=l[e].substring(t.length,l[e].length);l[e]=r+o}t=removeQuotedData(l[e])}while(t.includes("}"))}for(let e=0;e<l.length;++e)if(void 0!==l[e])if(Array.isArray(l[e]))for(let t=0;t<l[e].length;++t){let r=removeQuotedData(l[e][t]);do{if(r.includes("&")){let r=seekToFirstUnquotedSemicolonPreserving(l[e][t],"&"),o=l[e][t].substring(0,r.length-1),n=l[e][t].substring(r.length,l[e][t].length);l[e][t]=o+n}r=removeQuotedData(l[e][t])}while(r.includes("&"))}else{let t=removeQuotedData(l[e]);do{if(t.includes("&")){let t=seekToFirstUnquotedSemicolonPreserving(l[e],"&"),r=l[e].substring(0,t.length-1),o=l[e].substring(t.length,l[e].length);l[e]=r+o}t=removeQuotedData(l[e])}while(t.includes("&"))}for(let e=0;e<l.length;++e)if(void 0!==l[e])if(Array.isArray(l[e]))for(let t=0;t<l[e].length;++t){let r=removeQuotedData(l[e][t]);do{if(r.includes("@nest")){let r=seekToFirstUnquotedWord(l[e][t],"@nest"),o=l[e][t].substring(0,r.length-5),n=l[e][t].substring(r.length+4,l[e][t].length);l[e][t]=o+n}r=removeQuotedData(l[e][t])}while(r.includes("@nest"))}else{let t=removeQuotedData(l[e]);do{if(t.includes("@nest")){let t=seekToFirstUnquotedWord(l[e],"@nest"),r=l[e].substring(0,t.length-5),o=l[e].substring(t.length+4,l[e].length);l[e]=r+o}t=removeQuotedData(l[e])}while(t.includes("@nest"))}for(let e=0;e<l.length;++e)if(void 0!==l[e])if(Array.isArray(l[e]))for(let t=0;t<l[e].length;++t)l[e][t]=l[e][t].trim();else l[e]=l[e].trim();const u=new Map;for(let e=0;e<l.length;++e)void 0!==l[e]&&u.set(e,[]);void 0!==n[0]&&void 0===l[0]&&(r+=n[0]+" ");for(let e=0;e<l.length;++e)if(void 0!==l[e])if(Array.isArray(l[e]))for(let t=l[e].length-1;t>=0;--t){const o=n[e][t];let i="",s=t,g=-1;for(let t=0;t<=e;t++)if(void 0!==l[t])if(Array.isArray(l[t])){let r=removeQuotedData(l[t][s]);const o=u.get(e).length;for(;r.includes(",");){let o=seekToFirstUnquotedSemicolonPreserving(l[t][s],","),n=l[t][s].substring(0,o.length-1),g=l[t][s].substring(o.length,l[t][s].length);l[t][s]=g,u.get(e).push({idx:e,value:i+n+" ",origValue:i+n+" "}),r=removeQuotedData(l[t][s])}if(l[t][s].trim().startsWith(":")){if(""!==l[t][s]){i=i.trim()+l[t][s].trim()+" ";for(let r=0;r<o;++r)u.get(e)[r].value=u.get(e)[r].value.trim()+l[t][s].trim()+" ";for(const[r,o]of u)r<e&&o.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+l[t][s].trim()+" ",e-1>g&&(g=e-1))}))}}else if(""!==l[t][s]){i+=l[t][s]+" ";for(let r=0;r<o;++r)u.get(e)[r].value+=l[t][s]+" ";for(const[r,o]of u)r<e&&o.forEach((r=>{t>r.idx&&(r.value+=l[t][s].trim()+" ",e-1>g&&(g=e-1))}))}}else{let r=removeQuotedData(l[t]);const o=u.get(e).length;for(;r.includes(",");){let o=seekToFirstUnquotedSemicolonPreserving(l[t],","),n=l[t].substring(0,o.length-1),s=l[t].substring(o.length,l[t].length);l[t]=s,u.get(e).push({idx:e,value:i+n+" ",origValue:i+n+" "}),r=removeQuotedData(l[t])}if(l[t].trim().startsWith(":")){if(""!==l[t]){i=i.trim()+l[t].trim()+" ";for(let r=0;r<o;++r)u.get(e)[r].value=u.get(e)[r].value.trim()+l[t].trim()+" ";for(const[r,o]of u)r<e&&o.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+l[t].trim()+" ",e-1>g&&(g=e-1))}))}}else if(""!==l[t]){i+=l[t]+" ";for(let r=0;r<o;++r)u.get(e)[r].value+=l[t]+" ";for(const[r,o]of u)r<e&&o.forEach((r=>{t>r.idx&&(r.value=r.value+=l[t]+" ",e-1>g&&(g=e-1))}))}}if(i&&o){const e=formatMediaQuery(i);r+=null===e?i+"{"+o+"}\n":e[0]+"{"+e[1]+"{"+o+"} }\n"}for(let t=0;t<u.get(e).length;++t){const l=formatMediaQuery(u.get(e)[t].value);r+=null===l?u.get(e)[t].value+"{"+o+"}\n":l[0]+"{"+l[1]+"{"+o+"} }\n"}for(;g>=0;--g)if(void 0!==u.get(g))for(let e=0;e<u.get(g).length;++e){const t=formatMediaQuery(u.get(g)[e].value);r+=null===t?u.get(g)[e].value+"{"+o+"}\n":t[0]+"{"+t[1]+"{"+o+"} }\n",u.get(g)[e].value=u.get(g)[e].origValue}}else{const t=n[e];let o="",i=0,s=-1;for(let t=0;t<=e;t++)if(void 0!==l[t])if(Array.isArray(l[t])){let r=removeQuotedData(l[t][i]);const n=u.get(e).length;for(;r.includes(",");){let n=seekToFirstUnquotedSemicolonPreserving(l[t][i],","),s=l[t][i].substring(0,n.length-1),g=l[t][i].substring(n.length,l[t][i].length);l[t][i]=g,u.get(e).push({idx:e,value:o+s+" ",origValue:o+s+" "}),r=removeQuotedData(l[t][i])}if(l[t][i].trim().startsWith(":")){if(""!==l[t][i]){o=o.trim()+l[t][i].trim()+" ";for(let r=0;r<n;++r)u.get(e)[r].value=u.get(e)[r].value.trim()+l[t][i].trim()+" ";for(const[r,o]of u)r<e&&o.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+l[t][i].trim()+" ",e-1>s&&(s=e-1))}))}}else if(""!==l[t][i]){o+=l[t][i]+" ";for(let r=0;r<n;++r)u.get(e)[r].value+=l[t][i]+" ";for(const[r,o]of u)r<e&&o.forEach((r=>{t>r.idx&&(r.value+=l[t][i].trim()+" ",e-1>s&&(s=e-1))}))}}else{let r=removeQuotedData(l[t]);const n=u.get(e).length;for(;r.includes(",");){let n=seekToFirstUnquotedSemicolonPreserving(l[t],","),i=l[t].substring(0,n.length-1),s=l[t].substring(n.length,l[t].length);l[t]=s,u.get(e).push({idx:e,value:o+i+" ",origValue:o+i+" "}),r=removeQuotedData(l[t])}if(l[t].trim().startsWith(":")){if(""!==l[t]){o=o.trim()+l[t].trim()+" ";for(let r=0;r<n;++r)u.get(e)[r].value=u.get(e)[r].value.trim()+l[t].trim()+" ";for(const[r,o]of u)r<e&&o.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+l[t].trim()+" ",e-1>s&&(s=e-1))}))}}else if(""!==l[t]){o+=l[t]+" ";for(let r=0;r<n;++r)u.get(e)[r].value+=l[t]+" ";for(const[r,o]of u)r<e&&o.forEach((r=>{t>r.idx&&(r.value+=l[t]+" ",e-1>s&&(s=e-1))}))}}if(o&&t){const e=formatMediaQuery(o);r+=null===e?o+"{"+t+"}\n":e[0]+"{"+e[1]+"{"+t+"} }\n"}for(let o=0;o<u.get(e).length;++o){const l=formatMediaQuery(u.get(e)[o].value);r+=null===l?u.get(e)[o].value+"{"+t+"}\n":l[0]+"{"+l[1]+"{"+t+"} }\n"}for(;s>=0;--s)if(void 0!==u.get(s))for(let e=0;e<u.get(s).length;++e){const o=formatMediaQuery(u.get(s)[e].value);r+=null===o?u.get(s)[e].value+"{"+t+"}\n":o[0]+"{"+o[1]+"{"+t+"} }\n",u.get(s)[e].value=u.get(s)[e].origValue}}}else console.log(e),t=t.substring(e.length,t.length),r+=e.trim()+"\n"}return console.log(r),r},formatMediaQuery=e=>{let t=removeQuotedData(e),r="";for(;t.includes("@media");){let o=seekToFirstUnquotedWord(e,"@media"),l=e.substring(0,o.length-1),n=e.substring(o.length-1,e.length),i=n.substring(0,n.indexOf("@media")+6);n=n.substring(i.length,n.length).trim();let s=n.substring(0,n.indexOf(" "));for(;s.includes("(")&&countSubstr(s,"(")!==countSubstr(s,")");)s=n.substring(0,n.indexOf(")",s.length)+1);n=n.substring(s.length,n.length),i+=" "+s,r+=""===r?i:" and "+i,t=removeQuotedData(e=l+" "+n)}return""!==r?[r,e]:null},stylesheets=document.querySelectorAll("style");for(const e of stylesheets){let t=e.textContent,r=applyScopedCss(0,t);e.textContent=r}const externalSheets=document.querySelectorAll("link");for(const e of externalSheets)"stylesheet"===e.rel&&fetch(e.href).then((e=>e.text())).then((t=>{var r=document.createElement("style");r.textContent=applyScopedCss(0,t),document.head.appendChild(r),document.head.removeChild(e)}));