const countSubstr=(e,t)=>e.split(t).length-1;function removeQuotedData(e){let t="",r=!1,i=!1,l=!1;for(let s=0;s<e.length;++s)'"'!==e[s]||i||r?"'"!==e[s]||i||r?'"'===e[s]&&r&&!l||"'"===e[s]&&i&&!l?(i=!1,r=!1):'"'===e[s]&&r&&l||"'"===e[s]&&i&&l?l=!1:(l="\\"===e[s],i||r||(t+=e[s])):i=!0:r=!0;return t}function removeComments(e){let t="",r=!1,i=!1,l=!1,s=!1,n=!1,o=!1,g=!1;for(let a=0;a<e.length;++a)'"'!==e[a]||i||r?"'"!==e[a]||i||r?'"'===e[a]&&r&&!l||"'"===e[a]&&i&&!l?(i=!1,r=!1):l=('"'!==e[a]||!r||!l)&&(("'"!==e[a]||!i||!l)&&"\\"===e[a]):i=!0:r=!0,(o||!i&&!r)&&("/"!==e[a]||s?"*"!==e[a]&&(s=!1):s=!0,"/"===e[a]&&o&&n&&(o=!1,g=!0),"*"===e[a]&&s?(t=t.substring(0,t.length-1),o=!0,s=!1):n=!("*"!==e[a]||s||!o)),o||g||(t+=e[a]),g=!1;return t}function seekToFirstUnquotedSemicolon(e,t,r=0){let i="",l=!1,s=!1,n=!1;for(let o=r;o<e.length&&('"'!==e[o]||s||l?"'"!==e[o]||s||l?'"'===e[o]&&l&&!n||"'"===e[o]&&s&&!n?(s=!1,l=!1):n=('"'!==e[o]||!l||!n)&&(("'"!==e[o]||!s||!n)&&"\\"===e[o]):s=!0:l=!0,s||l||(i+=e[o]),e[o]!==t||l||s);++o);return i}function seekToFirstUnquotedSemicolonPreserving(e,t,r=0){let i="",l=!1,s=!1,n=!1;for(let o=r;o<e.length&&('"'!==e[o]||s||l?"'"!==e[o]||s||l?'"'===e[o]&&l&&!n||"'"===e[o]&&s&&!n?(s=!1,l=!1):n=('"'!==e[o]||!l||!n)&&(("'"!==e[o]||!s||!n)&&"\\"===e[o]):s=!0:l=!0,i+=e[o],e[o]!==t||l||s);++o);return i}function seekToFirstUnquotedWord(e,t,r=0){let i="",l=!1,s=!1,n=!1;for(let o=r;o<e.length;++o)if('"'!==e[o]||s||l?"'"!==e[o]||s||l?'"'===e[o]&&l&&!n||"'"===e[o]&&s&&!n?(s=!1,l=!1):n=('"'!==e[o]||!l||!n)&&(("'"!==e[o]||!s||!n)&&"\\"===e[o]):s=!0:l=!0,i+=e[o],e[o]===t[0]&&!l&&!s){let r=!0;for(let i=0;i<t.length;++i)(e.length>o+i&&e[o+i]!==t[i]||e.length<=o+i)&&(r=!1);if(r)break}return i}const trimRules=e=>{for(let t=0;t<e.length;++t)if(void 0!==e[t])if(Array.isArray(e[t]))for(let r=0;r<e[t].length;++r)Array.isArray(e[t][r])?trimRules(e[t][r]):e[t][r]=e[t][r].trim();else e[t]=e[t].trim()},applyScopedCss=e=>{let r="";e=removeComments(e);const i=/^\s/g,l=/[^\s]*\s/;for(;e.length>0;){let s=seekToFirstUnquotedSemicolonPreserving(e,"}");for(;s.trim().startsWith("@keyframes");){let t,i=seekToFirstUnquotedSemicolonPreserving(e,"}"),l=removeQuotedData(i),n=[i];for(;countSubstr(l,"{")!==countSubstr(l,"}");)t="",n.forEach((e=>t+=e)),i=seekToFirstUnquotedSemicolonPreserving(e,"}",t.length),n.push(i),t="",n.forEach((e=>t+=e)),l=removeQuotedData(t);t="",n.forEach((e=>t+=e)),e=e.substring(t.length,e.length),r+=t.trim()+"\n",s=seekToFirstUnquotedSemicolonPreserving(e,"}")}let n=removeQuotedData(s);for(;countSubstr(n,"{")!==countSubstr(n,"}");){let t=seekToFirstUnquotedSemicolonPreserving(e,"}",s.length);if(s+=t,n=removeQuotedData(s),""===t)break}let o=[];const g=[];let a,h=0;if(countSubstr(n,"{")>1){const n=s;let u=new Map,f=new Map;for(;removeQuotedData(s).includes("{");){let e=seekToFirstUnquotedSemicolonPreserving(s,"{"),t=removeQuotedData(e),r=!1;if(s=s.substring(e.length,s.length),t.includes("}")&&!t.includes(";")){let t=seekToFirstUnquotedSemicolon(e,"}");e=e.substring(t.length,e.length);const i=t.lastIndexOf("}");t=t.substring(0,i),t=t.trim()+";",g[h].push(t),r=!0}let i=t,l=0,n=h;if(!t.includes(";")){let t=e.trim();t.endsWith("{")&&(e=t.substring(0,t.length-1))}for(;t.includes(";");){const i=l;h-=l,l=0;let n="";for(;removeQuotedData(e).includes(";");){const t=seekToFirstUnquotedSemicolonPreserving(e,";");e=e.substring(t.length,e.length),n+=" "+t}let a=removeQuotedData(n);for(;a.includes("}");){let t=seekToFirstUnquotedSemicolonPreserving(n,"}"),r=n.substring(0,t.length-1),i=n.substring(t.length,n.length);n=r,e=i+e,a=removeQuotedData(n),l++}if(t=removeQuotedData(e),t.includes("}")&&!t.includes(";")){let t=seekToFirstUnquotedSemicolon(e,"}");const r=t.lastIndexOf("}");e=e.substring(r,e.length),t=t.substring(0,r),""!==t.trim()&&(t=t.trim()+";",n+=" "+t)}if(!r||r&&""!==n)if(0===i)void 0!==g[h]?Array.isArray(g[h])?(f.has(h)||f.set(h,g[h].length),g[h]=[...g[h],n]):(f.has(h)||f.set(h,0),g[h]=[g[h],n]):(f.has(h)||f.set(h,0),g[h]=n);else if(void 0!==g[h])if("string"==typeof o[h])f.has(h)||f.set(h,0),g[h]=g[h]+" "+n;else if(Array.isArray(g[h])){const e=removeQuotedData(s);let t=e.indexOf(";"),r=e.indexOf("{");if(-1===t&&(t=e.length),-1===r&&(r=e.length),Array.isArray(o[h])&&o[h].length>g[h].length&&t<r){let e=g[h];e[f.get(h)]=e[f.get(h)]+" "+n,g[h]=e}else{let e=g[h];e[u.get(h)]=e[u.get(h)]+" "+n,g[h]=e}}else f.has(h)||f.set(h,0),g[h]=g[h]+" "+n;else f.has(h)||f.set(h,0),g[h]=n;if(0===l){let t=e.trim();t.endsWith("{")&&(e=t.substring(0,t.length-1))}t=removeQuotedData(e)}h=n;let a=0;for(;i.includes("}");)i=i.substring(i.indexOf("}")+1,i.length),h--,a++;for(;i.includes("{");)if(i=i.substring(i.indexOf("{")+1,i.length),h++,0===a){let e=0;if(void 0!==o[h-1])if(Array.isArray(o[h-1])){let t=o[h-1].length;if(Array.isArray(o[h])||(o[h]=[]),void 0!==o[h-1]&&Array.isArray(o[h-1])&&u.set(h-1,o[h-1].length-1),0===o[h].length)for(;t>o[h].length;)o[h].unshift("");else for(e=o[h].length;t>o[h].length;)o[h].push("")}else void 0===o[h]?o[h]=[""]:Array.isArray(o[h])?o[h].unshift(""):Array.isArray(o[h])||(o[h]=["",o[h]]),void 0!==o[h-1]&&Array.isArray(o[h-1])&&u.set(h-1,o[h-1].length-1);else void 0===o[h]?o[h]=[""]:Array.isArray(o[h])?o[h].unshift(""):Array.isArray(o[h])||(o[h]=["",o[h]]),void 0!==o[h-1]&&Array.isArray(o[h-1])&&u.set(h-1,o[h-1].length-1);if(void 0!==g[h-1])if(Array.isArray(g[h-1])){let t=o[h].length;if(Array.isArray(g[h])||(g[h]=[]),0===e)for(;t>g[h].length;)g[h].unshift("");else for(;t>g[h].length;)g[h].push("")}else void 0===g[h]?g[h]=[""]:Array.isArray(g[h])?g[h].unshift(""):Array.isArray(g[h])||(g[h]=["",g[h]]);else void 0===g[h]?g[h]=[""]:Array.isArray(g[h])?g[h].unshift(""):Array.isArray(g[h])||(g[h]=["",g[h]])}else a--;if(void 0!==o[h])if("string"==typeof o[h]){o[h]=[o[h],e];const t=h;for(;h>=0;){for(;void 0!==o[h-1]&&Array.isArray(o[h-1])&&o[h-1].length<o[h].length;)for(o[h-1].push(o[h-1][o[h-1].length-1]);g[h-1].length<o[h-1].length;)g[h-1].push("");h--}h=t}else{o[h]=[...o[h],e];const t=h;for(;h>=0;){for(;void 0!==o[h-1]&&Array.isArray(o[h-1])&&o[h-1].length<o[h].length;)for(o[h-1].push(o[h-1][o[h-1].length-1]);g[h-1].length<o[h-1].length;)g[h-1].push("");h--}h=t}else if(h>1&&void 0!==o[h-1]&&Array.isArray(o[h-1])){o[h]=[];for(let e=0;e<o[h-1].length-1;++e)o[h].push("");o[h].push(e),g[h]=[];for(let e=0;e<o[h-1].length-1;++e)g[h].push("")}else toDupCount=0,o[h]=e,insertedNonArray=!0}let d,m=0;for(let e=g.length-1;e>=1;--e){const t=g[e-1];if(void 0===t)continue;const r=g[e];for(;Array.isArray(t)&&Array.isArray(r)&&t.length<r.length;)t.push("");g[e-1]=t}for(;removeQuotedData(s).includes(";");){const e=m;h-=m,m=0;let t="";for(;s.includes(";");){const e=seekToFirstUnquotedSemicolonPreserving(s,";");s=s.substring(e.length,s.length),t+=" "+e}let r=removeQuotedData(t);for(;r.includes("}");){let e=seekToFirstUnquotedSemicolonPreserving(t,"}"),i=t.substring(0,e.length-1);s=t.substring(e.length,t.length)+s,t=i,m++,r=removeQuotedData(t)}if(0===e)void 0!==g[h]?"string"==typeof o[h]?(f.has(h)||f.set(h,0),g[h]=[g[h],t]):Array.isArray(g[h])?(f.has(h)||f.set(h,g[h].length),g[h]=[...g[h],t]):(f.has(h)||f.set(h,0),g[h]=[g[h],t]):(f.has(h)||f.set(h,0),g[h]=t);else if(void 0!==g[h])if("string"==typeof o[h])f.has(h)||f.set(h,0),g[h]=g[h]+" "+t;else if(Array.isArray(g[h])){const e=removeQuotedData(s);let r=e.indexOf(";"),i=e.indexOf("{");if(-1===r&&(r=e.length),-1===i&&(i=e.length),Array.isArray(o[h])&&o[h].length>g[h].length&&r<i){let e=g[h];e[f.get(h)]=e[f.get(h)]+" "+t,g[h]=e}else{let e=g[h];e[u.get(h)]=e[u.get(h)]+" "+t,g[h]=e}}else f.has(h)||f.set(h,0),g[h]=g[h]+" "+t;else f.has(h)||f.set(h,0),g[h]=t}if(s.length>0&&removeQuotedData(s).includes("}")){let e=seekToFirstUnquotedSemicolon(s,"}");const t=e.lastIndexOf("}");e=e.substring(0,t),e=e.trim()+";",g[h].push(e)}trimRules(g),e=e.substring(n.length,e.length);for(let e=0;e<o.length;++e)if(void 0!==o[e])if(Array.isArray(o[e]))for(let t=0;t<o[e].length;++t){let r=removeQuotedData(o[e][t]);do{if(r.includes("}")){let r=seekToFirstUnquotedSemicolonPreserving(o[e][t],"}"),i=o[e][t].substring(0,r.length-1),l=o[e][t].substring(r.length,o[e][t].length);o[e][t]=i+l}r=removeQuotedData(o[e][t])}while(r.includes("}"))}else{let t=removeQuotedData(o[e]);do{if(t.includes("}")){let t=seekToFirstUnquotedSemicolonPreserving(o[e],"}"),r=o[e].substring(0,t.length-1),i=o[e].substring(t.length,o[e].length);o[e]=r+i}t=removeQuotedData(o[e])}while(t.includes("}"))}for(let e=0;e<o.length;++e)if(void 0!==o[e])if(Array.isArray(o[e]))for(let t=0;t<o[e].length;++t){let r=removeQuotedData(o[e][t]);do{if(r.includes("&")){let r=seekToFirstUnquotedSemicolonPreserving(o[e][t],"&"),l=o[e][t].substring(0,r.length-1),s=o[e][t].substring(r.length,o[e][t].length);const n=s[0].match(i);if(s.length>0&&(!n||0===n.length)&&e>1){const r=o[e-1][t];"&"!==r[r.length-1]&&(o[e-1][t]=r+"&")}o[e][t]=l+s}r=removeQuotedData(o[e][t])}while(r.includes("&"))}else{let t=removeQuotedData(o[e]);do{if(t.includes("&")){let t=seekToFirstUnquotedSemicolonPreserving(o[e],"&"),r=o[e].substring(0,t.length-1),i=o[e].substring(t.length,o[e].length);o[e]=r+i}t=removeQuotedData(o[e])}while(t.includes("&"))}for(let e=0;e<o.length;++e)if(void 0!==o[e])if(Array.isArray(o[e]))for(let t=0;t<o[e].length;++t){let r=removeQuotedData(o[e][t]);do{if(r.includes("@nest")){let r=seekToFirstUnquotedWord(o[e][t],"@nest"),i=o[e][t].substring(0,r.length-5),l=o[e][t].substring(r.length+4,o[e][t].length);o[e][t]=i+l}r=removeQuotedData(o[e][t])}while(r.includes("@nest"))}else{let t=removeQuotedData(o[e]);do{if(t.includes("@nest")){let t=seekToFirstUnquotedWord(o[e],"@nest"),r=o[e].substring(0,t.length-5),i=o[e].substring(t.length+4,o[e].length);o[e]=r+i}t=removeQuotedData(o[e])}while(t.includes("@nest"))}for(let e=0;e<o.length;++e)if(void 0!==o[e])if(Array.isArray(o[e]))for(let t=0;t<o[e].length;++t)o[e][t]=o[e][t].trim();else o[e]=o[e].trim();const y=new Map;for(let e=0;e<o.length;++e)void 0!==o[e]&&y.set(e,[]);void 0!==g[0]&&void 0===o[0]&&(r+=g[0]+" ");for(let e=0;e<o.length;++e)if(void 0!==o[e])if(Array.isArray(o[e]))for(let t=0;t<o[e].length;++t){let r=t;for(let t=0;t<=e;t++)if(void 0!==o[t])if(Array.isArray(o[t])&&o[t].length>r){let i=removeQuotedData(o[t][r]),s=!1;for(;i.includes(",");){let n=seekToFirstUnquotedSemicolonPreserving(o[t][r],","),a=o[t][r].substring(0,n.length-1),h=o[t][r].substring(n.length,o[t][r].length);if(i.endsWith("&")&&o.length>t+1||s){s=!0;let e=o[t+1][r];const i=e.match(l);if(h=h.trim(),i&&i.length>0){let l=i[0].trim();if(l.endsWith(",")&&(l=l.substring(0,l.length-1)),e=e.substring(l.length,e.length).trim(),a+=l,h=h.substring(0,h.length-1).trim()+l,e.endsWith("&")||0===l.length)if(0===l.length){o[t+1][r]=a+e,a="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=a+" "+e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}else{a+=e,h+=e,o[t+1][r]="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}let u=a.trim();u=u.startsWith("@")?u.substring(0,u.indexOf(" ")):"",o[t][r]=u+" "+h,o[t].splice(r,0,a),g[t].splice(r,0,g[t][r]);for(let t=0;t<o.length;++t)t!==e&&void 0!==o[t]&&(Array.isArray(o[t])&&o[t].length>r?o[t].splice(r,0,o[t][r]):Array.isArray(o[t])&&o[t].length===r||0===r&&(o[t]=[o[t],o[t]]));for(let t=0;t<g.length;++t)t!==e&&void 0!==g[t]&&(Array.isArray(g[t])&&g[t].length>r?g[t].splice(r,0,g[t][r]):Array.isArray(g[t])&&g[t].length===r||0===r&&(g[t]=[g[t],g[t]]));i=removeQuotedData(o[t][r])}}else if(!Array.isArray(o[t])){let i=removeQuotedData(o[t]),s=!1;for(;i.includes(",");){let n=seekToFirstUnquotedSemicolonPreserving(o[t],","),g=o[t].substring(0,n.length-1),a=o[t].substring(n.length,o[t].length);if(i.endsWith("&")&&o.length>t+1||s){s=!0;let e=o[t+1][r];const i=e.match(l);if(a=a.trim(),i&&i.length>0){let l=i[0].trim();if(l.endsWith(",")&&(l=l.substring(0,l.length-1)),e=e.substring(l.length,e.length).trim(),g+=l,a=a.substring(0,a.length-1).trim()+l,e.endsWith("&")||0===l.length)if(0===l.length){o[t+1][r]=g+e,g="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=g+" "+e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}else{g+=e,a+=e,o[t+1][r]="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}o[t]=a,o[t]=[o[t],g],i=removeQuotedData(o[t][r]);for(let t=e+1;t<o.length;++t)Array.isArray(o[t])&&o[t].length>r?o[t].splice(r,0,o[t][r]):0===r&&(o[t]=[o[t],o[t]])}}}else{g[e];let r=0;for(let i=0;i<=e;i++)if(void 0!==o[i])if(Array.isArray(o[i])){let s=removeQuotedData(o[i][r]),n=!1;for(;s.includes(",");){let g=seekToFirstUnquotedSemicolonPreserving(o[i][r],","),a=o[i][r].substring(0,g.length-1),h=o[i][r].substring(g.length,o[i][r].length);if(s.endsWith("&")&&o.length>t+1||n){n=!0;let e=o[t+1][r];const i=e.match(l);if(h=h.trim(),i&&i.length>0){let l=i[0].trim();if(l.endsWith(",")&&(l=l.substring(0,l.length-1)),e=e.substring(l.length,e.length).trim(),a+=l,h=h.substring(0,h.length-1).trim()+l,e.endsWith("&")||0===l.length)if(0===l.length){o[t+1][r]=a+e,a="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=a+" "+e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}else{a+=e,h+=e,o[t+1][r]="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}o[i][r]=h,o[i].splice(r,0,a),s=removeQuotedData(o[i][r]);for(let t=e+1;t<o.length;++t)Array.isArray(o[t])&&o[t].length>r?o[t].splice(r,0,o[t][r]):0===r&&(o[t]=[o[t],o[t]])}}else{let s=removeQuotedData(o[i]),n=!1;for(;s.includes(",");){let g=seekToFirstUnquotedSemicolonPreserving(o[i],","),a=o[i].substring(0,g.length-1),h=o[i].substring(g.length,o[i].length);if(s.endsWith("&")&&o.length>t+1||n){n=!0;let e=o[t+1][r];const i=e.match(l);if(h=h.trim(),i&&i.length>0){let l=i[0].trim();if(l.endsWith(",")&&(l=l.substring(0,l.length-1)),e=e.substring(l.length,e.length).trim(),a+=l,h=h.substring(0,h.length-1).trim()+l,e.endsWith("&")||0===l.length)if(0===l.length){o[t+1][r]=a+e,a="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=a+" "+e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}else{a+=e,h+=e,o[t+1][r]="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}o[i]=h,o[i]=[o[i],a],s=removeQuotedData(o[i][r]);for(let t=e+1;t<o.length;++t)Array.isArray(o[t])&&o[t].length>r?o[t].splice(r,0,o[t][r]):0===r&&(o[t]=[o[t],o[t]])}}}for(let e=0;e<o.length;++e)if(void 0!==o[e])if(Array.isArray(o[e]))for(let t=0;t<o[e].length;++t){let r=t;for(let t=0;t<=e;t++)if(void 0!==o[t])if(Array.isArray(o[t])&&o[t].length>r){let e=removeQuotedData(o[t][r]),i=!1,s=o[t][r].trim();if(e.endsWith("&")&&o.length>t+1||i){i=!0;let e=o[t+1][r];const n=e.match(l);if(n&&n.length>0){let i=n[0].trim();if(i.endsWith(",")&&(i=i.substring(0,i.length-1)),e=e.substring(i.length,e.length).trim(),s=s.trim().substring(0,s.length-1).trim()+i,e.endsWith("&")||0===i.length)if(0===i.length){o[t+1][r]=s+e,s="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=s+" "+e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}else{s=s.trim().substring(0,s.length-1).trim()+e,o[t+1][r]="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}o[t][r]=s}else if(!Array.isArray(o[t])){let e=removeQuotedData(o[t]),i=!1,s=o[t][r].trim();if(e.endsWith("&")&&o.length>t+1||i){i=!0;let e=o[t+1][r];const n=e.match(l);if(n&&n.length>0){let i=n[0].trim();if(i.endsWith(",")&&(i=i.substring(0,i.length-1)),e=e.substring(i.length,e.length).trim(),s=s.trim().substring(0,s.length-1).trim()+i,e.endsWith("&")||0===i.length)if(0===i.length){o[t+1][r]=s+e,s="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=s+" "+e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}else{s=s.trim().substring(0,s.length-1).trim()+e,o[t+1][r]="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}o[t]=s}}else{g[e];let r=0;for(let i=0;i<=e;i++)if(void 0!==o[i])if(Array.isArray(o[i])){let e=removeQuotedData(o[i][r]),s=!1,n=o[t][r].trim();if(e.endsWith("&")&&o.length>t+1||s){s=!0;let e=o[t+1][r];const i=e.match(l);if(i&&i.length>0){let l=i[0].trim();if(l.endsWith(",")&&(l=l.substring(0,l.length-1)),e=e.substring(l.length,e.length).trim(),n=n.trim().substring(0,n.length-1).trim()+l,e.endsWith("&")||0===l.length)if(0===l.length){o[t+1][r]=n+e,n="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=n+" "+e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}else{n=n.trim().substring(0,n.length-1).trim()+e,o[t+1][r]="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}o[i][r]=n}else{let e=removeQuotedData(o[i]),s=!1,n=o[t][r].trim();if(e.endsWith("&")&&o.length>t+1||s){s=!0;let e=o[t+1][r];const i=e.match(l);if(i&&i.length>0){let l=i[0].trim();if(l.endsWith(",")&&(l=l.substring(0,l.length-1)),e=e.substring(l.length,e.length).trim(),n=n.trim().substring(0,n.length-1).trim()+l,e.endsWith("&")||0===l.length)if(0===l.length){o[t+1][r]=n+e,n="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=n+" "+e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}else{o[t+1][r]=e;for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}else{n=n.trim().substring(0,n.length-1).trim()+e,o[t+1][r]="";for(let e=t-1;e>=0;--e)void 0!==o[e]&&Array.isArray(o[t])&&o[t].length>r&&(o[e][r]="")}}o[i]=n}}a="";for(let e=0;e<o.length;++e)if(void 0!==o[e])if(Array.isArray(o[e]))for(let t=o[e].length-1;t>=0;--t){const i=g[e][t];let l="",s=t,n=-1;for(let t=0;t<=e;t++)if(l.startsWith("@")&&(l.startsWith("@media")||l.startsWith("@layer"))&&(l+=" { "),a=l,void 0!==o[t])if(Array.isArray(o[t])&&o[t].length>s){let r=removeQuotedData(o[t][s]);const i=y.get(e).length;for(;r.includes(",");){let i=seekToFirstUnquotedSemicolonPreserving(o[t][s],","),l=o[t][s].substring(0,i.length-1),n=o[t][s].substring(i.length,o[t][s].length);o[t][s]=n,o[t].splice(s,0,l);for(let t=e+1;t<o.length;++t)Array.isArray(o[t])&&o[t].length>s?o[t].splice(s,0,o[t][s]):0===s&&(o[t]=[o[t],o[t]]);r=removeQuotedData(o[t][s])}if(o[t][s].trim().startsWith(":")){if(""!==o[t][s]){l=l.trim()+o[t][s].trim()+" ",d=o[t][s].trim();for(let r=0;r<i;++r)y.get(e)[r].value=y.get(e)[r].value.trim()+o[t][s].trim()+" ";for(const[r,i]of y)r<e&&i.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+o[t][s].trim()+" ",e-1>n&&(n=e-1))}))}}else if(""!==o[t][s]){l+=o[t][s]+" ",d=o[t][s];for(let r=0;r<i;++r)y.get(e)[r].value+=o[t][s]+" ";for(const[r,i]of y)r<e&&i.forEach((r=>{t>r.idx&&(r.value+=o[t][s].trim()+" ",e-1>n&&(n=e-1))}))}}else if(!Array.isArray(o[t])){let r=removeQuotedData(o[t]);const i=y.get(e).length;for(;r.includes(",");){let i=seekToFirstUnquotedSemicolonPreserving(o[t],","),l=o[t].substring(0,i.length-1),n=o[t].substring(i.length,o[t].length);o[t]=n,o[t]=[o[t],l],r=removeQuotedData(o[t][s]);for(let t=e+1;t<o.length;++t)Array.isArray(o[t])&&o[t].length>s?o[t].splice(s,0,o[t][s]):0===s&&(o[t]=[o[t],o[t]])}if(o[t].trim().startsWith(":")){if(""!==o[t]){l=l.trim()+o[t].trim()+" ",d=o[t].trim();for(let r=0;r<i;++r)y.get(e)[r].value=y.get(e)[r].value.trim()+o[t].trim()+" ";for(const[r,i]of y)r<e&&i.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+o[t].trim()+" ",e-1>n&&(n=e-1))}))}}else if(""!==o[t]){l+=o[t]+" ",d=o[t];for(let r=0;r<i;++r)y.get(e)[r].value+=o[t]+" ";for(const[r,i]of y)r<e&&i.forEach((r=>{t>r.idx&&(r.value=r.value+=o[t]+" ",e-1>n&&(n=e-1))}))}}if((l.replace(a,"").startsWith("@")&&l.replace(a,"").startsWith("@media")||!a.trim().endsWith("{")&&/@layer\s+[a-zA-Z_][a-zA-Z0-9_-]*\s+.*\s+$/.test(l))&&(l=a+" { "+l.replace(a,"")),l&&i){const e=formatMediaQuery(l);if(null===e)r+=l+"{"+i+"}\n";else{""!==e[1].trim()?r+=e[0]+"{"+e[1]+"{"+i+"} }\n":r+=e[0]+"{"+i+"}";for(let t=0;t<e[2];++t)r+="} "}}for(let t=0;t<y.get(e).length;++t){const l=formatMediaQuery(y.get(e)[t].value);if(null===l)r+=y.get(e)[t].value+"{"+i+"}\n";else{""!==l[1].trim()?r+=l[0]+"{"+l[1]+"{"+i+"} }\n":r+=l[0]+"{"+i+"}";for(let e=0;e<l[2];++e)r+="} "}}for(;n>=0;--n)if(void 0!==y.get(n))for(let e=0;e<y.get(n).length;++e){const t=formatMediaQuery(y.get(n)[e].value);if(null===t)r+=y.get(n)[e].value+"{"+i+"}\n";else{""!==t[1].trim()?r+=t[0]+"{"+t[1]+"{"+i+"} }\n":r+=t[0]+"{"+i+"}";for(let e=0;e<t[2];++e)r+="} "}y.get(n)[e].value=y.get(n)[e].origValue}}else{const t=g[e];let i="",l=0,s=-1;for(let t=0;t<=e;t++)if(void 0!==o[t])if(Array.isArray(o[t])){let r=removeQuotedData(o[t][l]);const n=y.get(e).length;for(;r.includes(",");){let i=seekToFirstUnquotedSemicolonPreserving(o[t][l],","),s=o[t][l].substring(0,i.length-1),n=o[t][l].substring(i.length,o[t][l].length);o[t][l]=n,o[t].splice(l,0,s),r=removeQuotedData(o[t][l]);for(let t=e+1;t<o.length;++t)Array.isArray(o[t])&&o[t].length>l?o[t].splice(l,0,o[t][l]):0===l&&(o[t]=[o[t],o[t]])}if(o[t][l].trim().startsWith(":")){if(""!==o[t][l]){i=i.trim()+o[t][l].trim()+" ",d=o[t][l].trim();for(let r=0;r<n;++r)y.get(e)[r].value=y.get(e)[r].value.trim()+o[t][l].trim()+" ";for(const[r,i]of y)r<e&&i.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+o[t][l].trim()+" ",e-1>s&&(s=e-1))}))}}else if(""!==o[t][l]){i+=o[t][l]+" ",d=o[t][l];for(let r=0;r<n;++r)y.get(e)[r].value+=o[t][l]+" ";for(const[r,i]of y)r<e&&i.forEach((r=>{t>r.idx&&(r.value+=o[t][l].trim()+" ",e-1>s&&(s=e-1))}))}}else{let r=removeQuotedData(o[t]);const n=y.get(e).length;for(;r.includes(",");){let i=seekToFirstUnquotedSemicolonPreserving(o[t],","),s=o[t].substring(0,i.length-1),n=o[t].substring(i.length,o[t].length);o[t]=n,o[t]=[o[t],s],r=removeQuotedData(o[t][l]);for(let t=e+1;t<o.length;++t)Array.isArray(o[t])&&o[t].length>l?o[t].splice(l,0,o[t][l]):0===l&&(o[t]=[o[t],o[t]])}if(o[t].trim().startsWith(":")){if(""!==o[t]){i=i.trim()+o[t].trim()+" ",d=o[t].trim();for(let r=0;r<n;++r)y.get(e)[r].value=y.get(e)[r].value.trim()+o[t].trim()+" ";for(const[r,i]of y)r<e&&i.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+o[t].trim()+" ",e-1>s&&(s=e-1))}))}}else if(""!==o[t]){i+=o[t]+" ",d=o[t];for(let r=0;r<n;++r)y.get(e)[r].value+=o[t]+" ";for(const[r,i]of y)r<e&&i.forEach((r=>{t>r.idx&&(r.value+=o[t]+" ",e-1>s&&(s=e-1))}))}}if(i&&t){const e=formatMediaQuery(i);if(null===e)r+=i+"{"+t+"}\n";else{""!==e[1].trim()?r+=e[0]+"{"+e[1]+"{"+t+"} }\n":r+=e[0]+"{"+t+"}";for(let t=0;t<e[2];++t)r+="} "}}for(let i=0;i<y.get(e).length;++i){const l=formatMediaQuery(y.get(e)[i].value);if(null===l){r+=y.get(e)[i].value+"{"+t+"}\n";for(let t=e-1;t>=0;--t)if(void 0!==y.get(t)){const e=[];for(let r=0;r<y.get(t).length;++r){const i={};i.origValue=y.get(t)[r].origValue+" "+d,i.value=y.get(t)[r].value+" "+d,i.idx=y.get(t)[r].idx,e.push(i)}const r=y.get(t).concat(e);y.set(t,r)}}else{""!==l[1].trim()?r+=l[0]+"{"+l[1]+"{"+t+"} }\n":r+=l[0]+"{"+t+"}";for(let e=0;e<l[2];++e)r+="} "}}for(;s>=0;--s)if(void 0!==y.get(s))for(let e=0;e<y.get(s).length;++e){const i=formatMediaQuery(y.get(s)[e].value);if(null===i)r+=y.get(s)[e].value+"{"+t+"}\n";else{""!==i[1].trim()?r+=i[0]+"{"+i[1]+"{"+t+"} }\n":r+=i[0]+"{"+t+"}";for(let e=0;e<i[2];++e)r+="} "}y.get(s)[e].value=y.get(s)[e].origValue}}}else e=e.substring(s.length,e.length),r+=s.trim()+"\n"}return r},atSet=new Set(["@media","@layer"]),formatMediaQuery=(e,t=!1)=>{let r,i=removeQuotedData(e),l="",s=0;for(const n of atSet)for(;i.includes(n);){let o=seekToFirstUnquotedWord(e,n),g=e.substring(0,o.length-1),a=e.substring(o.length-1,e.length),h=a.substring(0,a.indexOf(n)+n.length);a=a.substring(h.length,a.length).trim(),!0===t&&(h=" { @media ");let u="",f=seekToFirstUnquotedSemicolon(a," ");for(f.length>u.length&&(u=f),f=seekToFirstUnquotedSemicolon(a,"{"),f.length>u.length&&(u=f),!a.includes(" ")&&u.length<a&&(u=a);u.includes("(")&&countSubstr(u,"(")!==countSubstr(u,")");)u=a.substring(0,a.indexOf(")",u.length)+1);for(a=a.substring(u.length,a.length),r=a.trim();r.startsWith("@media");){let[e,t,i]=formatMediaQuery(r,!0);u=u.trim(),u.endsWith("{")&&(u=u.substring(0,u.length-1)),e=e.trim(),e.endsWith("{")&&(e=e.substring(0,e.length-1)),u+=e,r=t.trim();const l=seekToFirstUnquotedSemicolonPreserving(a,"{");a=a.substring(l.length,a.length)}h+=" "+u,""===l?l+=h:"@media"===n?l+=" "+h:"@layer"===n&&(l=l.trim(),l.endsWith("{")||(l+=" { "),l+=h),0===s?e=g+" "+a:(""!==g.trim()&&(a=g+" "+a),e=" "+a),i=removeQuotedData(e)}if(""!==l){l=l.trim(),l.endsWith("{")&&(l=l.substring(0,l.length-1)),(e=e.trim()).endsWith("{")&&(e=e.substring(0,e.length-1));let t=removeQuotedData(e);return s+=countSubstr(t,"{"),t=removeQuotedData(l),s+=countSubstr(t,"{"),[l,e,s]}return null};function transformNess(){const e=document.querySelectorAll("style");for(const t of e){let e=t.textContent,r=applyScopedCss(e);t.textContent=r}}transformNess();export{transformNess};