const fs=require("fs"),countSubstr=(e,t)=>e.split(t).length-1;function removeQuotedData(e){let t="",r=!1,l=!1,s=!1;for(let i=0;i<e.length;++i)'"'!==e[i]||l||r?"'"!==e[i]||l||r?'"'===e[i]&&r&&!s||"'"===e[i]&&l&&!s?(l=!1,r=!1):'"'===e[i]&&r&&s||"'"===e[i]&&l&&s?s=!1:(s="\\"===e[i],l||r||(t+=e[i])):l=!0:r=!0;return t}function removeComments(e){let t="",r=!1,l=!1,s=!1,i=!1,n=!1,o=!1,g=!1;for(let a=0;a<e.length;++a)'"'!==e[a]||l||r?"'"!==e[a]||l||r?'"'===e[a]&&r&&!s||"'"===e[a]&&l&&!s?(l=!1,r=!1):s=('"'!==e[a]||!r||!s)&&(("'"!==e[a]||!l||!s)&&"\\"===e[a]):l=!0:r=!0,(o||!l&&!r)&&("/"!==e[a]||i?"*"!==e[a]&&(i=!1):i=!0,"/"===e[a]&&o&&n&&(o=!1,g=!0),"*"===e[a]&&i?(t=t.substring(0,t.length-1),o=!0,i=!1):n=!("*"!==e[a]||i||!o)),o||g||(t+=e[a]),g=!1;return t}function seekToFirstUnquotedSemicolon(e,t,r=0){let l="",s=!1,i=!1,n=!1;for(let o=r;o<e.length&&('"'!==e[o]||i||s?"'"!==e[o]||i||s?'"'===e[o]&&s&&!n||"'"===e[o]&&i&&!n?(i=!1,s=!1):n=('"'!==e[o]||!s||!n)&&(("'"!==e[o]||!i||!n)&&"\\"===e[o]):i=!0:s=!0,i||s||(l+=e[o]),e[o]!==t||s||i);++o);return l}function seekToFirstUnquotedSemicolonPreserving(e,t,r=0){let l="",s=!1,i=!1,n=!1;for(let o=r;o<e.length&&('"'!==e[o]||i||s?"'"!==e[o]||i||s?'"'===e[o]&&s&&!n||"'"===e[o]&&i&&!n?(i=!1,s=!1):n=('"'!==e[o]||!s||!n)&&(("'"!==e[o]||!i||!n)&&"\\"===e[o]):i=!0:s=!0,l+=e[o],e[o]!==t||s||i);++o);return l}function seekToFirstUnquotedWord(e,t,r=0){let l="",s=!1,i=!1,n=!1;for(let o=r;o<e.length;++o)if('"'!==e[o]||i||s?"'"!==e[o]||i||s?'"'===e[o]&&s&&!n||"'"===e[o]&&i&&!n?(i=!1,s=!1):n=('"'!==e[o]||!s||!n)&&(("'"!==e[o]||!i||!n)&&"\\"===e[o]):i=!0:s=!0,l+=e[o],e[o]===t[0]&&!s&&!i){let r=!0;for(let l=0;l<t.length;++l)(e.length>o+l&&e[o+l]!==t[l]||e.length<=o+l)&&(r=!1);if(r)break}return l}const trimRules=e=>{for(let t=0;t<e.length;++t)if(void 0!==e[t])if(Array.isArray(e[t]))for(let r=0;r<e[t].length;++r)Array.isArray(e[t][r])?trimRules(e[t][r]):e[t][r]=e[t][r].trim();else e[t]=e[t].trim()},applyScopedCss=e=>{let t="";for(e=removeComments(e);e.length>0;){let r=seekToFirstUnquotedSemicolonPreserving(e,"}"),l=removeQuotedData(r);for(;countSubstr(l,"{")!==countSubstr(l,"}");){let t=seekToFirstUnquotedSemicolonPreserving(e,"}",r.length);if(r+=t,l=removeQuotedData(r),""===t)break}let s=[];const i=[];let n=0;if(countSubstr(l,"{")>1){const l=r;let o=new Map,g=new Map;for(;removeQuotedData(r).includes("{");){let e=seekToFirstUnquotedSemicolonPreserving(r,"{"),t=removeQuotedData(e),l=!1;if(r=r.substring(e.length,r.length),t.includes("}")&&!t.includes(";")){let t=seekToFirstUnquotedSemicolon(e,"}");e=e.substring(t.length,e.length);const r=t.lastIndexOf("}");t=t.substring(0,r),t=t.trim()+";",i[n].push(t),l=!0}let a=t,u=0,f=n;if(!t.includes(";")){let t=e.trim();t.endsWith("{")&&(e=t.substring(0,t.length-1))}for(;t.includes(";");){const a=u;n-=u,u=0;let f="";for(;removeQuotedData(e).includes(";");){const t=seekToFirstUnquotedSemicolonPreserving(e,";");e=e.substring(t.length,e.length),f+=" "+t}let h=removeQuotedData(f);for(;h.includes("}");){let t=seekToFirstUnquotedSemicolonPreserving(f,"}"),r=f.substring(0,t.length-1),l=f.substring(t.length,f.length);f=r,e=l+e,h=removeQuotedData(f),u++}if(t=removeQuotedData(e),t.includes("}")&&!t.includes(";")){let t=seekToFirstUnquotedSemicolon(e,"}");const r=t.lastIndexOf("}");e=e.substring(r,e.length),t=t.substring(0,r),""!==t.trim()&&(t=t.trim()+";",f+=" "+t)}if(!l||l&&""!==f)if(0===a)void 0!==i[n]?Array.isArray(i[n])?(g.has(n)||g.set(n,i[n].length),i[n]=[...i[n],f]):(g.has(n)||g.set(n,0),i[n]=[i[n],f]):(g.has(n)||g.set(n,0),i[n]=f);else if(void 0!==i[n])if("string"==typeof s[n])g.has(n)||g.set(n,0),i[n]=i[n]+" "+f;else if(Array.isArray(i[n])){const e=removeQuotedData(r);let t=e.indexOf(";"),l=e.indexOf("{");if(-1===t&&(t=e.length),-1===l&&(l=e.length),Array.isArray(s[n])&&s[n].length>i[n].length&&t<l){let e=i[n];e[g.get(n)]=e[g.get(n)]+" "+f,i[n]=e}else{let e=i[n];e[o.get(n)]=e[o.get(n)]+" "+f,i[n]=e}}else g.has(n)||g.set(n,0),i[n]=i[n]+" "+f;else g.has(n)||g.set(n,0),i[n]=f;if(0===u){let t=e.trim();t.endsWith("{")&&(e=t.substring(0,t.length-1))}t=removeQuotedData(e)}n=f;let h=0;for(;a.includes("}");)a=a.substring(a.indexOf("}")+1,a.length),n--,h++;for(;a.includes("{");)if(a=a.substring(a.indexOf("{")+1,a.length),n++,0===h){let e=0;if(void 0!==s[n-1])if(Array.isArray(s[n-1])){let t=s[n-1].length;if(Array.isArray(s[n])||(s[n]=[]),void 0!==s[n-1]&&Array.isArray(s[n-1])&&o.set(n-1,s[n-1].length-1),0===s[n].length)for(;t>s[n].length;)s[n].unshift("");else for(e=s[n].length;t>s[n].length;)s[n].push("")}else void 0===s[n]?s[n]=[""]:Array.isArray(s[n])?s[n].unshift(""):Array.isArray(s[n])||(s[n]=["",s[n]]),void 0!==s[n-1]&&Array.isArray(s[n-1])&&o.set(n-1,s[n-1].length-1);else void 0===s[n]?s[n]=[""]:Array.isArray(s[n])?s[n].unshift(""):Array.isArray(s[n])||(s[n]=["",s[n]]),void 0!==s[n-1]&&Array.isArray(s[n-1])&&o.set(n-1,s[n-1].length-1);if(void 0!==i[n-1])if(Array.isArray(i[n-1])){let t=s[n].length;if(Array.isArray(i[n])||(i[n]=[]),0===e)for(;t>i[n].length;)i[n].unshift("");else for(;t>i[n].length;)i[n].push("")}else void 0===i[n]?i[n]=[""]:Array.isArray(i[n])?i[n].unshift(""):Array.isArray(i[n])||(i[n]=["",i[n]]);else void 0===i[n]?i[n]=[""]:Array.isArray(i[n])?i[n].unshift(""):Array.isArray(i[n])||(i[n]=["",i[n]])}else h--;if(void 0!==s[n])if("string"==typeof s[n]){s[n]=[s[n],e];const t=n;for(;n>=0;){for(;void 0!==s[n-1]&&Array.isArray(s[n-1])&&s[n-1].length<s[n].length;)for(s[n-1].push(s[n-1][s[n-1].length-1]);i[n-1].length<s[n-1].length;)i[n-1].push("");n--}n=t}else{s[n]=[...s[n],e];const t=n;for(;n>=0;){for(;void 0!==s[n-1]&&Array.isArray(s[n-1])&&s[n-1].length<s[n].length;)for(s[n-1].push(s[n-1][s[n-1].length-1]);i[n-1].length<s[n-1].length;)i[n-1].push("");n--}n=t}else if(n>1&&void 0!==s[n-1]&&Array.isArray(s[n-1])){s[n]=[];for(let e=0;e<s[n-1].length-1;++e)s[n].push("");s[n].push(e),i[n]=[];for(let e=0;e<s[n-1].length-1;++e)i[n].push("")}else toDupCount=0,s[n]=e,insertedNonArray=!0}let a,u=0;for(let e=i.length-1;e>=1;--e){const t=i[e-1];if(void 0===t)continue;const r=i[e];for(;Array.isArray(t)&&Array.isArray(r)&&t.length<r.length;)t.push("");i[e-1]=t}for(;removeQuotedData(r).includes(";");){const e=u;n-=u,u=0;let t="";for(;r.includes(";");){const e=seekToFirstUnquotedSemicolonPreserving(r,";");r=r.substring(e.length,r.length),t+=" "+e}let l=removeQuotedData(t);for(;l.includes("}");){let e=seekToFirstUnquotedSemicolonPreserving(t,"}"),s=t.substring(0,e.length-1);r=t.substring(e.length,t.length)+r,t=s,u++,l=removeQuotedData(t)}if(0===e)void 0!==i[n]?"string"==typeof s[n]?(g.has(n)||g.set(n,0),i[n]=[i[n],t]):Array.isArray(i[n])?(g.has(n)||g.set(n,i[n].length),i[n]=[...i[n],t]):(g.has(n)||g.set(n,0),i[n]=[i[n],t]):(g.has(n)||g.set(n,0),i[n]=t);else if(void 0!==i[n])if("string"==typeof s[n])g.has(n)||g.set(n,0),i[n]=i[n]+" "+t;else if(Array.isArray(i[n])){const e=removeQuotedData(r);let l=e.indexOf(";"),a=e.indexOf("{");if(-1===l&&(l=e.length),-1===a&&(a=e.length),Array.isArray(s[n])&&s[n].length>i[n].length&&l<a){let e=i[n];e[g.get(n)]=e[g.get(n)]+" "+t,i[n]=e}else{let e=i[n];e[o.get(n)]=e[o.get(n)]+" "+t,i[n]=e}}else g.has(n)||g.set(n,0),i[n]=i[n]+" "+t;else g.has(n)||g.set(n,0),i[n]=t}if(r.length>0&&removeQuotedData(r).includes("}")){let e=seekToFirstUnquotedSemicolon(r,"}");const t=e.lastIndexOf("}");e=e.substring(0,t),e=e.trim()+";",i[n].push(e)}trimRules(i),e=e.substring(l.length,e.length);for(let e=0;e<s.length;++e)if(void 0!==s[e])if(Array.isArray(s[e]))for(let t=0;t<s[e].length;++t){let r=removeQuotedData(s[e][t]);do{if(r.includes("}")){let r=seekToFirstUnquotedSemicolonPreserving(s[e][t],"}"),l=s[e][t].substring(0,r.length-1),i=s[e][t].substring(r.length,s[e][t].length);s[e][t]=l+i}r=removeQuotedData(s[e][t])}while(r.includes("}"))}else{let t=removeQuotedData(s[e]);do{if(t.includes("}")){let t=seekToFirstUnquotedSemicolonPreserving(s[e],"}"),r=s[e].substring(0,t.length-1),l=s[e].substring(t.length,s[e].length);s[e]=r+l}t=removeQuotedData(s[e])}while(t.includes("}"))}for(let e=0;e<s.length;++e)if(void 0!==s[e])if(Array.isArray(s[e]))for(let t=0;t<s[e].length;++t){let r=removeQuotedData(s[e][t]);do{if(r.includes("&")){let r=seekToFirstUnquotedSemicolonPreserving(s[e][t],"&"),l=s[e][t].substring(0,r.length-1),i=s[e][t].substring(r.length,s[e][t].length);s[e][t]=l+i}r=removeQuotedData(s[e][t])}while(r.includes("&"))}else{let t=removeQuotedData(s[e]);do{if(t.includes("&")){let t=seekToFirstUnquotedSemicolonPreserving(s[e],"&"),r=s[e].substring(0,t.length-1),l=s[e].substring(t.length,s[e].length);s[e]=r+l}t=removeQuotedData(s[e])}while(t.includes("&"))}for(let e=0;e<s.length;++e)if(void 0!==s[e])if(Array.isArray(s[e]))for(let t=0;t<s[e].length;++t){let r=removeQuotedData(s[e][t]);do{if(r.includes("@nest")){let r=seekToFirstUnquotedWord(s[e][t],"@nest"),l=s[e][t].substring(0,r.length-5),i=s[e][t].substring(r.length+4,s[e][t].length);s[e][t]=l+i}r=removeQuotedData(s[e][t])}while(r.includes("@nest"))}else{let t=removeQuotedData(s[e]);do{if(t.includes("@nest")){let t=seekToFirstUnquotedWord(s[e],"@nest"),r=s[e].substring(0,t.length-5),l=s[e].substring(t.length+4,s[e].length);s[e]=r+l}t=removeQuotedData(s[e])}while(t.includes("@nest"))}for(let e=0;e<s.length;++e)if(void 0!==s[e])if(Array.isArray(s[e]))for(let t=0;t<s[e].length;++t)s[e][t]=s[e][t].trim();else s[e]=s[e].trim();const f=new Map;for(let e=0;e<s.length;++e)void 0!==s[e]&&f.set(e,[]);void 0!==i[0]&&void 0===s[0]&&(t+=i[0]+" ");for(let e=0;e<s.length;++e)if(void 0!==s[e])if(Array.isArray(s[e]))for(let t=0;t<s[e].length;++t){let r=t;for(let t=0;t<=e;t++)if(void 0!==s[t])if(Array.isArray(s[t])&&s[t].length>r){let l=removeQuotedData(s[t][r]);for(;l.includes(",");){let n=seekToFirstUnquotedSemicolonPreserving(s[t][r],","),o=s[t][r].substring(0,n.length-1),g=s[t][r].substring(n.length,s[t][r].length);s[t][r]=g,s[t].splice(r,0,o),i[t].splice(r,0,i[t][r]);for(let t=0;t<s.length;++t)t!==e&&void 0!==s[t]&&(Array.isArray(s[t])&&s[t].length>r?s[t].splice(r,0,s[t][r]):Array.isArray(s[t])&&s[t].length===r||0===r&&(s[t]=[s[t],s[t]]));for(let t=0;t<i.length;++t)t!==e&&void 0!==i[t]&&(Array.isArray(i[t])&&i[t].length>r?i[t].splice(r,0,i[t][r]):Array.isArray(i[t])&&i[t].length===r||0===r&&(i[t]=[i[t],i[t]]));l=removeQuotedData(s[t][r])}}else if(!Array.isArray(s[t])){let l=removeQuotedData(s[t]);for(;l.includes(",");){let i=seekToFirstUnquotedSemicolonPreserving(s[t],","),n=s[t].substring(0,i.length-1),o=s[t].substring(i.length,s[t].length);s[t]=o,s[t]=[s[t],n],l=removeQuotedData(s[t][r]);for(let t=e+1;t<s.length;++t)Array.isArray(s[t])&&s[t].length>r?s[t].splice(r,0,s[t][r]):0===r&&(s[t]=[s[t],s[t]])}}}else{i[e];let t=0;for(let r=0;r<=e;r++)if(void 0!==s[r])if(Array.isArray(s[r])){let l=removeQuotedData(s[r][t]);for(;l.includes(",");){let i=seekToFirstUnquotedSemicolonPreserving(s[r][t],","),n=s[r][t].substring(0,i.length-1),o=s[r][t].substring(i.length,s[r][t].length);s[r][t]=o,s[r].splice(t,0,n),l=removeQuotedData(s[r][t]);for(let r=e+1;r<s.length;++r)Array.isArray(s[r])&&s[r].length>t?s[r].splice(t,0,s[r][t]):0===t&&(s[r]=[s[r],s[r]])}}else{let l=removeQuotedData(s[r]);for(;l.includes(",");){let i=seekToFirstUnquotedSemicolonPreserving(s[r],","),n=s[r].substring(0,i.length-1),o=s[r].substring(i.length,s[r].length);s[r]=o,s[r]=[s[r],n],l=removeQuotedData(s[r][t]);for(let r=e+1;r<s.length;++r)Array.isArray(s[r])&&s[r].length>t?s[r].splice(t,0,s[r][t]):0===t&&(s[r]=[s[r],s[r]])}}}for(let e=0;e<s.length;++e)if(void 0!==s[e])if(Array.isArray(s[e]))for(let r=s[e].length-1;r>=0;--r){const l=i[e][r];let n="",o=r,g=-1;for(let t=0;t<=e;t++)if(void 0!==s[t])if(Array.isArray(s[t])&&s[t].length>o){let r=removeQuotedData(s[t][o]);const l=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(s[t][o],","),i=s[t][o].substring(0,l.length-1),n=s[t][o].substring(l.length,s[t][o].length);s[t][o]=n,s[t].splice(o,0,i);for(let t=e+1;t<s.length;++t)Array.isArray(s[t])&&s[t].length>o?s[t].splice(o,0,s[t][o]):0===o&&(s[t]=[s[t],s[t]]);r=removeQuotedData(s[t][o])}if(s[t][o].trim().startsWith(":")){if(""!==s[t][o]){n=n.trim()+s[t][o].trim()+" ",a=s[t][o].trim();for(let r=0;r<l;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+s[t][o].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+s[t][o].trim()+" ",e-1>g&&(g=e-1))}))}}else if(""!==s[t][o]){n+=s[t][o]+" ",a=s[t][o];for(let r=0;r<l;++r)f.get(e)[r].value+=s[t][o]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=s[t][o].trim()+" ",e-1>g&&(g=e-1))}))}}else if(!Array.isArray(s[t])){let r=removeQuotedData(s[t]);const l=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(s[t],","),i=s[t].substring(0,l.length-1),n=s[t].substring(l.length,s[t].length);s[t]=n,s[t]=[s[t],i],r=removeQuotedData(s[t][o]);for(let t=e+1;t<s.length;++t)Array.isArray(s[t])&&s[t].length>o?s[t].splice(o,0,s[t][o]):0===o&&(s[t]=[s[t],s[t]])}if(s[t].trim().startsWith(":")){if(""!==s[t]){n=n.trim()+s[t].trim()+" ",a=s[t].trim();for(let r=0;r<l;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+s[t].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+s[t].trim()+" ",e-1>g&&(g=e-1))}))}}else if(""!==s[t]){n+=s[t]+" ",a=s[t];for(let r=0;r<l;++r)f.get(e)[r].value+=s[t]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value+=s[t]+" ",e-1>g&&(g=e-1))}))}}if(n&&l){const e=formatMediaQuery(n);if(null===e)t+=n+"{"+l+"}\n";else{""!==e[1].trim()?t+=e[0]+"{"+e[1]+"{"+l+"} }\n":t+=e[0]+"{"+l+"}";for(let r=0;r<e[2];++r)t+="} "}}for(let r=0;r<f.get(e).length;++r){const s=formatMediaQuery(f.get(e)[r].value);if(null===s)t+=f.get(e)[r].value+"{"+l+"}\n";else{""!==s[1].trim()?t+=s[0]+"{"+s[1]+"{"+l+"} }\n":t+=s[0]+"{"+l+"}";for(let e=0;e<s[2];++e)t+="} "}}for(;g>=0;--g)if(void 0!==f.get(g))for(let e=0;e<f.get(g).length;++e){const r=formatMediaQuery(f.get(g)[e].value);if(null===r)t+=f.get(g)[e].value+"{"+l+"}\n";else{""!==r[1].trim()?t+=r[0]+"{"+r[1]+"{"+l+"} }\n":t+=r[0]+"{"+l+"}";for(let e=0;e<r[2];++e)t+="} "}f.get(g)[e].value=f.get(g)[e].origValue}}else{const r=i[e];let l="",n=0,o=-1;for(let t=0;t<=e;t++)if(void 0!==s[t])if(Array.isArray(s[t])){let r=removeQuotedData(s[t][n]);const i=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(s[t][n],","),i=s[t][n].substring(0,l.length-1),o=s[t][n].substring(l.length,s[t][n].length);s[t][n]=o,s[t].splice(n,0,i),r=removeQuotedData(s[t][n]);for(let t=e+1;t<s.length;++t)Array.isArray(s[t])&&s[t].length>n?s[t].splice(n,0,s[t][n]):0===n&&(s[t]=[s[t],s[t]])}if(s[t][n].trim().startsWith(":")){if(""!==s[t][n]){l=l.trim()+s[t][n].trim()+" ",a=s[t][n].trim();for(let r=0;r<i;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+s[t][n].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+s[t][n].trim()+" ",e-1>o&&(o=e-1))}))}}else if(""!==s[t][n]){l+=s[t][n]+" ",a=s[t][n];for(let r=0;r<i;++r)f.get(e)[r].value+=s[t][n]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=s[t][n].trim()+" ",e-1>o&&(o=e-1))}))}}else{let r=removeQuotedData(s[t]);const i=f.get(e).length;for(;r.includes(",");){let l=seekToFirstUnquotedSemicolonPreserving(s[t],","),i=s[t].substring(0,l.length-1),o=s[t].substring(l.length,s[t].length);s[t]=o,s[t]=[s[t],i],r=removeQuotedData(s[t][n]);for(let t=e+1;t<s.length;++t)Array.isArray(s[t])&&s[t].length>n?s[t].splice(n,0,s[t][n]):0===n&&(s[t]=[s[t],s[t]])}if(s[t].trim().startsWith(":")){if(""!==s[t]){l=l.trim()+s[t].trim()+" ",a=s[t].trim();for(let r=0;r<i;++r)f.get(e)[r].value=f.get(e)[r].value.trim()+s[t].trim()+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value=r.value.trim()+s[t].trim()+" ",e-1>o&&(o=e-1))}))}}else if(""!==s[t]){l+=s[t]+" ",a=s[t];for(let r=0;r<i;++r)f.get(e)[r].value+=s[t]+" ";for(const[r,l]of f)r<e&&l.forEach((r=>{t>r.idx&&(r.value+=s[t]+" ",e-1>o&&(o=e-1))}))}}if(l&&r){const e=formatMediaQuery(l);if(null===e)t+=l+"{"+r+"}\n";else{""!==e[1].trim()?t+=e[0]+"{"+e[1]+"{"+r+"} }\n":t+=e[0]+"{"+r+"}";for(let r=0;r<e[2];++r)t+="} "}}for(let l=0;l<f.get(e).length;++l){const s=formatMediaQuery(f.get(e)[l].value);if(null===s){t+=f.get(e)[l].value+"{"+r+"}\n";for(let t=e-1;t>=0;--t)if(void 0!==f.get(t)){const e=[];for(let r=0;r<f.get(t).length;++r){const l={};l.origValue=f.get(t)[r].origValue+" "+a,l.value=f.get(t)[r].value+" "+a,l.idx=f.get(t)[r].idx,e.push(l)}const r=f.get(t).concat(e);f.set(t,r)}}else{""!==s[1].trim()?t+=s[0]+"{"+s[1]+"{"+r+"} }\n":t+=s[0]+"{"+r+"}";for(let e=0;e<s[2];++e)t+="} "}}for(;o>=0;--o)if(void 0!==f.get(o))for(let e=0;e<f.get(o).length;++e){const l=formatMediaQuery(f.get(o)[e].value);if(null===l)t+=f.get(o)[e].value+"{"+r+"}\n";else{""!==l[1].trim()?t+=l[0]+"{"+l[1]+"{"+r+"} }\n":t+=l[0]+"{"+r+"}";for(let e=0;e<l[2];++e)t+="} "}f.get(o)[e].value=f.get(o)[e].origValue}}}else e=e.substring(r.length,e.length),t+=r.trim()+"\n"}return t},atSet=new Set(["@media","@layer"]),formatMediaQuery=e=>{let t=removeQuotedData(e),r="",l=0;for(const s of atSet)for(;t.includes(s);){let i=seekToFirstUnquotedWord(e,s),n=e.substring(0,i.length-1),o=e.substring(i.length-1,e.length),g=o.substring(0,o.indexOf(s)+s.length);o=o.substring(g.length,o.length).trim();let a="",u=seekToFirstUnquotedSemicolon(o," ");for(u.length>a&&(a=u),u=seekToFirstUnquotedSemicolon(o,"{"),u.length>a&&(a=u),!o.includes(" ")&&a.length<o&&(a=o);a.includes("(")&&countSubstr(a,"(")!==countSubstr(a,")");)a=o.substring(0,o.indexOf(")",a.length)+1);o=o.substring(a.length,o.length),g+=" "+a,""===r?r+=g:"@media"===s?r+=" and "+g:"@layer"===s&&(r+=" { "+g,l++),0===l?e=n+" "+o:(""!==n.trim()&&(o=n+" "+o),e=" "+o),t=removeQuotedData(e)}return""!==r?[r,e,l]:null},myArgs=process.argv.slice(2);if(myArgs.length<2)console.log("Arguments:"),console.log("node index.node.min.js pathToInputFile pathToOutputFile");else try{const e=applyScopedCss(fs.readFileSync(myArgs[0],"utf8"));try{fs.writeFileSync(myArgs[1],e)}catch(e){console.error(e)}}catch(e){console.error(e)}